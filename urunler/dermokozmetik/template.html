<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Ürün Detayı | Dermokozmetik | Serakıncı</title>
  <meta name="description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  <!-- canonical JS ile güncellenecek -->
  <link rel="canonical" href="https://www.serakinci.com/">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- ---------------- STİLLER ---------------- -->
  <style>
    :root{
      --primary:#3b82f6;--primary-hover:#2563eb;
      --bg:#f8f9fa;--card:#fff;
      --text-dark:#111827;--text-medium:#4b5563;--text-light:#9ca3af;
      --border:#e5e7eb;--radius:10px;
      --shadow:0 .125rem .25rem rgba(0,0,0,.075);
      --shadow-md:0 .5rem 1rem rgba(0,0,0,.1);
    }
    html{scroll-behavior:smooth}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text-dark);-webkit-font-smoothing:antialiased}
    a{color:var(--primary)}a:hover{text-decoration:underline}
    .container{max-width:1140px;margin:0 auto;padding:1.5rem 1rem}

    /* —— Arama barı —— */
    .site-header{background:var(--card);padding:1rem 0;box-shadow:var(--shadow);position:sticky;top:0;z-index:1000}
    .search-bar-container{max-width:1140px;margin:0 auto;padding:0 1rem;position:relative}
    .search-input-wrapper{display:flex;align-items:center;background:#eff1f3;border-radius:var(--radius);padding:.5rem 1rem}
    .search-input-wrapper svg{margin-right:.75rem;color:var(--text-light);width:20px;height:20px}
    #productSearchInput{flex:1;border:none;background:transparent;font-size:1rem;color:var(--text-dark)}
    #productSearchInput::placeholder{color:var(--text-light)}
    #searchResultsDropdown{position:absolute;top:100%;left:0;right:0;background:var(--card);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--radius) var(--radius);box-shadow:var(--shadow-md);max-height:300px;overflow-y:auto;z-index:999;display:none}
    #searchResultsDropdown ul{list-style:none;margin:0;padding:0}
    #searchResultsDropdown li a{display:flex;align-items:center;padding:.75rem 1rem;border-bottom:1px solid var(--border);color:var(--text-dark)}
    #searchResultsDropdown li:last-child a{border-bottom:none}
    #searchResultsDropdown li a:hover{background:#f1f3f5}
    .suggestion-image{width:40px;height:40px;object-fit:contain;margin-right:.75rem;border-radius:var(--radius);border:1px solid var(--border)}
    .suggestion-name{font-weight:500;flex-grow:1}
    .suggestion-category{font-size:.8rem;color:var(--text-light);margin-left:.5rem}
    .no-results{padding:1rem;text-align:center;color:var(--text-medium)}

    /* —— Breadcrumbs —— */
    .breadcrumbs{display:flex;flex-wrap:wrap;align-items:center;font-size:.875rem;margin-bottom:2rem;color:var(--text-medium)}
    .breadcrumb-separator{margin:0 .5rem;color:var(--text-light)}
    .breadcrumb-current{color:var(--text-dark);font-weight:500}

    /* —— Ana ürün alanı —— */
    .product-main-layout{display:grid;grid-template-columns:1fr;gap:2rem;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-md);padding:2rem;margin-bottom:2.5rem}
    @media(min-width:768px){.product-main-layout{grid-template-columns:2fr 3fr}}
    .product-main-image-wrapper{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:#fff;box-shadow:var(--shadow)}
    .product-main-image{display:block;width:100%;aspect-ratio:1/1;object-fit:contain;padding:.5rem;cursor:pointer}
    .image-placeholder{display:flex;align-items:center;justify-content:center;width:100%;aspect-ratio:1/1;background:#e9ecef;color:var(--text-medium)}
    .product-info{display:flex;flex-direction:column}
    .product-title-wrapper{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:.75rem}
    .product-title{font-size:2rem;font-weight:700;line-height:1.3;margin:0 .5rem 0 0}
    .product-meta{font-size:.9rem;color:var(--text-medium);margin-bottom:1rem;display:flex;flex-wrap:wrap;gap:.5rem 1.2rem}
    .product-meta strong{color:var(--text-dark);font-weight:600}
    .product-short-description{font-size:1rem;color:var(--text-medium);margin-bottom:1.5rem;line-height:1.7}

    /* —— Sekmeler —— */
    .tabs-navigation{display:flex;border-bottom:1px solid var(--border);overflow-x:auto;background:#f8f9fa}
    .tab-link{flex-shrink:0;padding:1rem 1.5rem;font-size:1rem;font-weight:600;background:transparent;border:none;cursor:pointer;color:var(--text-medium);border-bottom:3px solid transparent}
    .tab-link:hover{color:var(--primary);background:#e9ecef}
    .tab-link.active{color:var(--primary);border-bottom-color:var(--primary);background:var(--card)}
    .tab-content{padding:1.5rem 2rem}
    .tab-pane{display:none;line-height:1.7;font-size:.9375rem;color:var(--text-medium)}
    .tab-pane.active{display:block}
    .tab-pane h3{font-size:1.25rem;font-weight:700;color:var(--text-dark);margin-top:0}

    /* —— İlgili ürünler —— */
    .related-products-section{margin-bottom:2.5rem}
    .related-products-title{font-size:1.75rem;font-weight:700;margin-bottom:1.5rem;color:var(--text-dark);border-bottom:2px solid var(--primary);padding-bottom:.75rem}
    .related-products-container{display:flex;gap:1.5rem;overflow-x:auto;padding-bottom:1rem}
    .related-products-container::-webkit-scrollbar{display:none}
    .related-product-card{flex:0 0 auto;width:240px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);text-decoration:none;color:var(--text-dark);transition:.2s}
    .related-product-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-md)}
    .related-product-card img{width:100%;height:180px;object-fit:contain;padding:.5rem;border-bottom:1px solid var(--border)}
    .related-product-card .info{padding:1rem}
    .related-product-card .name{font-weight:600;font-size:.9375rem;margin-bottom:.25rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;height:2.8em}
    .related-product-card .category{font-size:.8rem;color:var(--text-light)}

    /* —— Lightbox —— */
    .lightbox-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);align-items:center;justify-content:center;z-index:1050}
    .lightbox-modal.show{display:flex}
    .lightbox-content{max-width:90vw;max-height:90vh;animation:lightboxZoom .3s}
    @keyframes lightboxZoom{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
    .lightbox-close{position:absolute;top:20px;right:35px;color:#fff;font-size:40px;cursor:pointer}

    /* —— Scroll-top —— */
    .scroll-to-top{position:fixed;bottom:20px;right:20px;width:48px;height:48px;border:none;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;visibility:hidden;transform:translateY(20px);transition:.3s;z-index:999;box-shadow:var(--shadow-md)}
    .scroll-to-top.show{opacity:1;visibility:visible;transform:translateY(0)}

    /* —— Loader / Hata —— */
    .loading-container,.error-container{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-md);padding:3rem 1.5rem;text-align:center;max-width:600px;margin:3rem auto}
    .loading-spinner{width:48px;height:48px;border:4px solid #e9ecef;border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1.5rem}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- ====== ARAMA BAR ====== -->
  <header class="site-header">
    <div class="search-bar-container">
      <div class="search-input-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input id="productSearchInput" type="text" placeholder="Ürün ara…">
      </div>
      <div id="searchResultsDropdown"><ul id="searchResultsList"></ul></div>
    </div>
  </header>

  <main>
    <div class="container" id="productDetailContainer">
      <div class="loading-container"><div class="loading-spinner"></div><p class="loading-text">Ürün bilgileri yükleniyor…</p></div>
    </div>
  </main>

  <!-- LIGHTBOX -->
  <div id="imageLightbox" class="lightbox-modal"><span class="lightbox-close">×</span><img id="lightboxImg" class="lightbox-content"></div>

  <!-- SCROLL-TOP -->
  <button id="scrollToTopBtn" class="scroll-to-top" title="Başa dön">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>

  <script>
    /* ---------- AYAR ---------- */
    const segment='dermokozmetik';           // sadece bu satırı kategoriye göre değiştir

    /* ---------- YARDIMCILAR ---------- */
    const slugify=str=>str.toString()
      .replace(/[ÇĞİÖŞÜçğıöşü]/g,m=>({Ç:'C',Ğ:'G',İ:'I',Ö:'O',Ş:'S',Ü:'U',ç:'c',ğ:'g',ı:'i',ö:'o',ş:'s',ü:'u'}[m]))
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-');

    const getSlugFromUrl=()=>{const p=location.pathname.split('/');return p.length>=5&&p[3]==='product'?p[4]:''};

    let allProducts=[];let debounce;

    document.addEventListener('DOMContentLoaded',()=>{
      const slug=getSlugFromUrl();
      document.querySelector('link[rel="canonical"]').href=slug?location.href:location.origin+location.pathname;
      slug?loadProductDetail(slug):(loadAllProductsForSearch(),hideLoader());
      setupScrollBtn();setupLightbox();setupSearch();
    });

    /* ---------- TÜM ÜRÜNLER (arama / ilgili) ---------- */
    async function loadAllProductsForSearch(){
      try{const r=await fetch('/urunler/api/products.json');if(!r.ok)throw r.status;allProducts=await r.json();}catch(e){console.error(e);}
    }

    /* ---------- ÜRÜN DETAY ---------- */
    async function loadProductDetail(slug){
      try{
        const [listR,detailR]=await Promise.all([
          fetch('/urunler/api/products.json'),
          fetch('/urunler/api/detay-product.json')
        ]);
        if(!listR.ok||!detailR.ok)throw new Error('Veri alınamadı');
        allProducts=await listR.json();const details=await detailR.json();
        const product=allProducts.find(p=>slugify(p.ProductName)===slug);
        if(!product){return showError('Ürün bulunamadı');}
        const detail=details.find(d=>d.ProductId===product.ProductId||slugify(d.ProductName)===slugify(product.ProductName));
        renderDetail(product,detail);
      }catch(err){console.error(err);showError('Ürün yüklenemedi');}
    }

    function renderDetail(p,d){
      const cont=document.getElementById('productDetailContainer');
      const img=p.ImageUrl||(p.ProductImages?.[0]?.ImageUrl)||'';
      /* -------- Breadcrumb -------- */
      const bread=`<nav class="breadcrumbs">
        <a class="breadcrumb-link" href="/">Ana Sayfa</a><span class="breadcrumb-separator">></span>
        <a class="breadcrumb-link" href="/urunler/">Ürün Kataloğu</a><span class="breadcrumb-separator">></span>
        <a class="breadcrumb-link" href="/urunler/${segment}/">${segment.charAt(0).toUpperCase()+segment.slice(1)}</a>
        ${p.cat?`<span class="breadcrumb-separator">></span><a class="breadcrumb-link" href="/urunler/${segment}/?kategori=${slugify(p.cat)}">${p.cat}</a>`:''}
        <span class="breadcrumb-separator">></span><span class="breadcrumb-current">${p.ProductName}</span>
      </nav>`;
      /* -------- Meta -------- */
      const meta=`<div class="product-meta">
        ${p.brand?`<span><strong>Marka:</strong> ${p.brand}</span>`:''}
        ${p.cat?`<span><strong>Kategori:</strong> ${p.cat}</span>`:''}
        ${p.ProductCode?`<span><strong>Kod:</strong> <span id="productCodeValue">${p.ProductCode}</span> <a style="cursor:pointer" onclick="copyCode(event)">(kopyala)</a></span>`:''}
      </div>`;
      /* -------- Tabs -------- */
      const tab1=`<h3>Ürün Açıklaması</h3><div>${d?.['Ürün Açıklaması']||'Bilgi hazırlanıyor.'}</div>`;
      const tab2=d?.['Üretici Firma']?`<h3>Üretici Firma</h3><div>${d['Üretici Firma']}</div>`:'<p>Ek bilgi bulunamadı.</p>';
      const tab3=`<h3>Kullanım / Uyarılar</h3><div>${d?.['Dikkat edilmesi gerekenler ya da uyarılar']||'Belirtilmemiştir.'}</div>`;
      /* -------- İlgili -------- */
      const rel=allProducts.filter(x=>x.cat===p.cat&&slugify(x.ProductName)!==slugify(p.ProductName)).slice(0,10);
      const relHTML=rel.length?`<div class="related-products-section"><h2 class="related-products-title">Benzer Ürünler</h2><div class="related-products-container">
        ${rel.map(r=>`<a class="related-product-card" href="/urunler/${segment}/product/${slugify(r.ProductName)}/">
            <img src="${r.ImageUrl||(r.ProductImages?.[0]?.ImageUrl)||''}" alt="${r.ProductName}">
            <div class="info"><div class="name">${r.ProductName}</div><div class="category">${r.cat||''}</div></div></a>`).join('')}
      </div></div>`:'';

      cont.innerHTML=`${bread}
        <div class="product-main-layout">
          <div>${img?`<div class="product-main-image-wrapper" id="imgWrap"><img class="product-main-image" src="${img}" alt="${p.ProductName}"></div>`:`<div class="product-main-image-wrapper"><div class="image-placeholder">Görsel hazırlanıyor</div></div>`}</div>
          <div class="product-info">
            <div class="product-title-wrapper"><h1 class="product-title">${p.ProductName}</h1></div>
            ${meta}
            <div class="product-short-description"><p>${p.ProductName} Serakıncı güvencesiyle Kuzey Kıbrıs’ta sizlerle.</p></div>
          </div>
        </div>

        <div class="product-details-tabs">
          <div class="tabs-navigation">
            <button class="tab-link active" data-tab="tab1">Detaylar</button>
            <button class="tab-link" data-tab="tab2">Ek Bilgiler</button>
            <button class="tab-link" data-tab="tab3">Uyarılar</button>
          </div>
          <div class="tab-content">
            <div id="tab1" class="tab-pane active">${tab1}</div>
            <div id="tab2" class="tab-pane">${tab2}</div>
            <div id="tab3" class="tab-pane">${tab3}</div>
          </div>
        </div>

        ${relHTML}
        <a href="/urunler/${segment}/" style="display:inline-block;margin-top:2rem"><span style="margin-right:.4rem">←</span>${segment.charAt(0).toUpperCase()+segment.slice(1)} ürünlerine dön</a>`;

      /* sekmeler */
      cont.querySelectorAll('.tab-link').forEach(btn=>btn.addEventListener('click',()=>{
        cont.querySelectorAll('.tab-link').forEach(b=>b.classList.remove('active'));
        cont.querySelectorAll('.tab-pane').forEach(pn=>pn.classList.remove('active'));
        btn.classList.add('active');cont.querySelector('#'+btn.dataset.tab).classList.add('active');
      }));
      /* lightbox */
      const w=document.getElementById('imgWrap');if(w&&img){w.onclick=()=>{document.getElementById('lightboxImg').src=img;document.getElementById('imageLightbox').classList.add('show');}}
    }

    /* ---------- UI tool-helpers ---------- */
    function showError(msg){document.getElementById('productDetailContainer').innerHTML=`<div class="error-container"><h2>Hata</h2><p>${msg}</p><a href="/urunler/${segment}/">← Geri dön</a></div>`;}
    function hideLoader(){const l=document.querySelector('.loading-container');l&&l.remove();}
    function copyCode(e){const val=document.getElementById('productCodeValue');if(!val)return;navigator.clipboard.writeText(val.innerText).then(()=>{
      const t=document.createElement('div');t.textContent='Kopyalandı';t.style.cssText='position:fixed;padding:.3rem .7rem;background:#333;color:#fff;border-radius:4px;font-size:.8rem;top:'+(e.clientY-35)+'px;left:'+(e.clientX-20)+'px;z-index:2000';document.body.append(t);setTimeout(()=>t.remove(),1500);
    });}
    function setupScrollBtn(){const b=document.getElementById('scrollToTopBtn');window.addEventListener('scroll',()=>b.classList.toggle('show',scrollY>100));b.onclick=()=>scrollTo({top:0,behavior:'smooth'});}
    function setupLightbox(){const m=document.getElementById('imageLightbox');m.querySelector('.lightbox-close').onclick=()=>m.classList.remove('show');m.onclick=e=>{if(e.target===m)m.classList.remove('show');};}

    /* ---------- Basit arama ---------- */
    function setupSearch(){
      const input=document.getElementById('productSearchInput'),dd=document.getElementById('searchResultsDropdown'),list=document.getElementById('searchResultsList');
      input.addEventListener('input',e=>{
        const term=e.target.value.toLowerCase();clearTimeout(debounce);
        if(term.length<2){dd.style.display='none';list.innerHTML='';return;}
        debounce=setTimeout(()=>{
          if(!allProducts.length){list.innerHTML='<li class="no-results">Ürünler yükleniyor…</li>';dd.style.display='block';return;}
          const res=allProducts.filter(p=>p.ProductName.toLowerCase().includes(term)).slice(0,7);
          list.innerHTML=res.length?res.map(p=>{
            const img=p.ImageUrl||(p.ProductImages?.[0]?.ImageUrl)||'https://via.placeholder.com/40';
            return `<li><a href="/urunler/${segment}/product/${slugify(p.ProductName)}/"><img class="suggestion-image" src="${img}" alt=""><span class="suggestion-name">${p.ProductName}</span>${p.cat?`<span class="suggestion-category">${p.cat}</span>`:''}</a></li>`;
          }).join(''):'<li class="no-results">Sonuç bulunamadı.</li>';
          dd.style.display='block';
        },300);
      });
      document.addEventListener('click',e=>{if(!input.contains(e.target)&&!dd.contains(e.target))dd.style.display='none';});
    }
  </script>
</body>
</html>
