<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ürün Detayı | Dermokozmetik | Serakıncı</title>
  <meta name="description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  <link rel="canonical" href="https://www.serakinci.com/">

  <link rel="icon" href="/urunler/assets/logos/logobrowser/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="16x16" href="/urunler/assets/logos/logobrowser/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/urunler/assets/logos/logobrowser/favicon-32x32.png">
  <link rel="apple-touch-icon" href="/urunler/assets/logos/logobrowser/apple-icon.png">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Yükleniyor...",
    "description": "Yükleniyor...",
    "image": "",
    "offers": {
      "@type": "Offer",
      "priceCurrency": "TRY",
      "price": "0.00",
      "availability": "https://schema.org/InStock"
    },
    "brand": {
      "@type": "Brand",
      "name": "Yükleniyor..."
    }
  }
  </script>
  <meta property="og:title" content="Ürün Detayı | Dermokozmetik | Serakıncı">
  <meta property="og:description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  <meta property="og:type" content="og:product">
  <meta property="og:url" content="">
  <meta property="og:site_name" content="Serakıncı">
  <meta property="og:locale" content="tr_TR">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ürün Detayı | Dermokozmetik | Serakıncı">
  <meta name="twitter:description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Satoshi:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script type="importmap">
  {
    "imports": {
      "@google/genai": "https://esm.sh/@google/generative-ai"
    }
  }
  </script>

  <style>
    :root {
      --primary-theme: #50C8C6; 
      --primary-theme-hover: #40A8A6;
      --accent: #f97316; 
      
      --background: #f8f9fa;
      --card-bg: #ffffff;
      --text-dark: #212529;
      --text-medium: #495057;
      --text-light: #6c757d;
      --border-color: #dee2e6;
      --radius: 0.375rem;
      --shadow-sm: 0 .125rem .25rem rgba(0,0,0,.075);
      --shadow-md: 0 .5rem 1rem rgba(0,0,0,.1);
    }
    html { scroll-behavior: smooth; box-sizing: border-box; }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: inherit; overflow-wrap: break-word; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: var(--text-dark); background-color: var(--background); line-height: 1.6; overflow-x: hidden; -webkit-font-smoothing:antialiased; }
    img, svg { max-width: 100%; height: auto; display: block; }
    .container { max-width: 1140px; margin: 0 auto; padding: 1.5rem 1rem; }
    .loading-container, .error-container { text-align: center; padding: 3rem 1rem; background-color: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow-md); max-width: 600px; margin: 3rem auto; }
    .loading-spinner { width: 48px; height: 48px; border: 4px solid #e9ecef; border-top: 4px solid var(--primary-theme); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1.5rem auto; }
    .loading-text { color: var(--text-medium); font-size: 1rem; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .new-site-header { font-family: 'Satoshi', sans-serif; background-color: #ffffff; padding: 0.8rem 0; border-bottom: 1px solid #e0e6e8; position: sticky; top: 0; z-index: 1030; }
    .new-header-content { display: flex; justify-content: space-between; align-items: center; margin: 0 auto; padding: 0 1.5rem; max-width:1100px; }
    .new-site-logo-link { display: flex; align-items: center; text-decoration: none; }
    .new-site-logo-img { height: 36px; margin-right: 0.6rem; }
    .new-site-logo-text { font-size: 1.3rem; font-weight: 500; color: #1C274C; }
    .new-site-navigation { display: flex; gap: 1.5rem; margin-left: auto; margin-right: 1.5rem;}
    .new-nav-link { color: #1C274C; text-decoration: none; font-weight: 500; font-size: 0.9rem; padding: 0.3rem 0; position: relative; transition: color 0.2s ease; cursor: pointer; white-space: nowrap; }
    .new-nav-link:hover { color: var(--primary-theme); }
    .new-header-actions { display: flex; align-items: center; gap: 1rem; }
    .language-switcher { display: flex; gap: 0.5rem; }
    .language-selector { background-color: #f1f3f5; border: 1px solid #dee2e6; color: #495057; padding: 0.4rem 0.8rem; border-radius: var(--radius); font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease; }
    .language-selector:hover, .language-selector.active { background-color: var(--primary-theme); color: white; border-color: var(--primary-theme); }
    .b2b-login-button { background-color: #212A40; color: #ffffff; padding: 0.5rem 1.2rem; border-radius: 20px; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: background-color 0.2s ease; }
    .mobile-menu-toggle { display: none; }
    .product-main-layout { display: grid; grid-template-columns: 1fr 2fr; gap: 2.5rem; margin-bottom: 2.5rem; background-color: var(--card-bg); padding: 2rem; border-radius: var(--radius); box-shadow: var(--shadow-md); }
    .product-title-modern { font-size: 2rem; font-weight: 700; color: var(--text-dark); line-height: 1.3; }
    .product-short-description { font-size: 1rem; color: var(--text-medium); margin-bottom: 1.5rem; line-height: 1.7; }
    .product-details-tabs-modern { background-color: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow-md); margin-bottom: 2.5rem; overflow: hidden; }
    .tabs-navigation-modern { display: flex; border-bottom: 1px solid var(--border-color); background-color: #f8f9fa; }
    .tab-link-modern { padding: 1rem 1.5rem; cursor: pointer; border: none; background-color: transparent; color: var(--text-medium); font-size: 1rem; font-weight: 600; position: relative; border-bottom: 3px solid transparent; transition: all 0.2s ease; }
    .tab-link-modern:hover { color: var(--primary-theme); background-color: #e9ecef; }
    .tab-link-modern.active { color: var(--primary-theme); border-bottom-color: var(--primary-theme); background-color: var(--card-bg); }
    .tab-content-modern { padding: 1.5rem 2rem; }
    .tab-pane-modern { display: none; line-height: 1.7; color: var(--text-medium); }
    .tab-pane-modern.active { display: block; }
    .tab-pane-modern h3 { font-size: 1.25rem; font-weight: 700; color: var(--text-dark); margin-bottom: 1rem; }
    /* Diğer stilleriniz buraya eklenebilir */
  </style>
</head>
<body>
  <header class="new-site-header" id="newSiteHeader">
    <div class="new-header-content main-container">
      <a href="https://www.serakinci.com" class="new-site-logo-link" title="Serakıncı Ana Sayfa">
        <img src="/urunler/assets/logos/logo.png" alt="Serakıncı Logo" class="new-site-logo-img">
        <span class="new-site-logo-text" data-i18n="headerLogoText">Serakıncı Limited</span>
      </a>
      <nav class="new-site-navigation">
        <a href="https://serakinci.com/bizkimiz" class="new-nav-link" data-i18n="navBizKimiz">Biz Kimiz?</a>
        <a href="https://serakinci.com/services" class="new-nav-link" data-i18n="navHizmetlerimiz">Hizmetlerimiz</a>
        <a href="/urunler/" class="new-nav-link" data-i18n="navUrunler">Ürünler</a>
        <a href="https://serakinci.com/careers" class="new-nav-link" data-i18n="navKariyer">Kariyer</a>
        <a href="https://serakinci.com/contact" class="new-nav-link" data-i18n="navBizeUlasin">Bize Ulaşın</a>
      </nav>
      <div class="new-header-actions">
         <div class="language-switcher">
          <button class="language-selector" data-lang="tr" aria-label="Dil Seçimi: Türkçe">TR</button>
          <button class="language-selector" data-lang="en" aria-label="Language Selection: English">EN</button>
          <button class="language-selector" data-lang="ru" aria-label="Выбор языка: Русский">RU</button>
        </div>
        <a href="https://siparis.serakinci.com/" class="b2b-login-button" data-i18n="b2bLoginButtonText">B2B Giriş</a>
        <button class="mobile-menu-toggle" aria-label="Menüyü Aç/Kapat" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="product-detail-page">
    <div class="container" id="productDetailContainer"> 
      <div class="loading-container"> 
        <div class="loading-spinner"></div>
        <p class="loading-text" data-i18n="loadingText">Ürün bilgileri yükleniyor...</p>
      </div>
    </div>
  </main>
  
  <footer>
     </footer>
  
  <script src="/urunler/assets/js/translations.js"></script>
  <script src="/assets/i18n.js"></script>

  <script type="module">
    // --- SABİTLER ---
    const API_BASE_PATH = '/urunler/api/';
    const FALLBACK_IMAGE_URL = '/urunler/assets/logos/resimyok.png';
    const LOCAL_IMAGE_BASE = `${API_BASE_PATH}gorseller/`;

    // --- GENEL DEĞİŞKENLER ---
    let allProducts = [];
    let currentProduct = null;
    let productDetail = null; // detay-product.json'dan gelen orijinal veri
    let biodermaDataCache = {}; // Her dilin verisini burada saklayacağız

    // --- YARDIMCI FONKSİYONLAR ---

    // Dile göre doğru JSON dosyasının adını döndürür
    function getBiodermaFilename(lang) {
        if (lang === 'ru') return 'products_bioderma_ru.json';
        if (lang === 'en') return 'products_bioderma_en.json';
        return 'products_bioderma.json'; // Varsayılan dil (Türkçe)
    }

    // Belirtilen dildeki Bioderma ürün verisini çeker veya önbellekten alır
    async function loadBiodermaData(lang = 'tr') {
        if (biodermaDataCache[lang]) {
            console.log(`'${getBiodermaFilename(lang)}' önbellekten kullanıldı.`);
            return biodermaDataCache[lang];
        }
        try {
            const filename = getBiodermaFilename(lang);
            console.log(`'${filename}' sunucudan yükleniyor...`);
            const data = await fetchJsonData(filename);
            biodermaDataCache[lang] = data;
            return data;
        } catch (e) {
            console.warn(`${getBiodermaFilename(lang)} yüklenemedi:`, e);
            biodermaDataCache[lang] = [];
            return [];
        }
    }

    function slugify(text) {
        if (text == null) return 'isimsiz-urun';
        let str = String(text);
        const trMap = { 'ç':'c','Ç':'C','ğ':'g','Ğ':'G','ı':'i','İ':'I','ö':'o','Ö':'O','ş':'s','Ş':'S','ü':'u','Ü':'U' };
        for (const key in trMap) str = str.replace(new RegExp(key, 'g'), trMap[key]);
        str = str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        str = str.replace(/\s+/g, '-').replace(/[^\w-]+/g, '').replace(/--+/g, '-').replace(/^-+|-+$/g, '');
        return str || 'isimsiz-urun';
    }

    async function fetchJsonData(fileName) {
        try {
            const response = await fetch(`${API_BASE_PATH}${fileName}`);
            if (!response.ok) throw new Error(`Ağ hatası: ${response.statusText}`);
            return await response.json();
        } catch (error) {
            console.error(`'${fileName}' yüklenirken hata:`, error);
            throw error;
        }
    }
    
    function getSlugFromUrl() {
      const pathname = window.location.pathname;
      const parts = pathname.split('/');
      return parts[parts.length - 1] || parts[parts.length - 2];
    }
    
    function findBiodermaExtra(allData, product) {
        if (!product || !allData) return null;
        const pid = String(product.ProductId);
        const code = String(product.ProductCode);
        return allData.find(b => String(b.ProductId) === pid) ||
               allData.find(b => b.sku && String(b.sku) === code) || null;
    }

    // --- ANA UYGULAMA MANTIĞI ---

    async function loadProductDetail(slugFromUrl) {
      const detailContainer = document.getElementById('productDetailContainer');
      detailContainer.innerHTML = `<div class="loading-container"><div class="loading-spinner"></div><p>Ürün bilgileri yükleniyor...</p></div>`;

      try {
        if (allProducts.length === 0) {
            allProducts = await fetchJsonData('products.json');
        }
        
        currentProduct = allProducts.find(p => p.ProductName && slugify(p.ProductName) === slugFromUrl);

        if (!currentProduct) {
            detailContainer.innerHTML = `<div class="error-container"><h2>Ürün Bulunamadı</h2><p>Aradığınız ürün mevcut değil veya bağlantı hatalı.</p></div>`;
            return;
        }
        
        // Diğer detayları çek (bu dosya çevrilmiyor, sabit)
        try {
            const detailsResponse = await fetchJsonData('detay-product.json');
            productDetail = detailsResponse.find(d => d.ProductId === currentProduct.ProductId);
        } catch (e) {
            productDetail = null;
            console.warn("detay-product.json yüklenemedi.");
        }

        // Sayfanın mevcut diline göre Bioderma verisini çek
        const lang = document.documentElement.lang || 'tr';
        const biodermaResponse = await loadBiodermaData(lang);
        const biodermaExtraData = findBiodermaExtra(biodermaResponse, currentProduct);
        
        displayProductDetail(currentProduct, productDetail, biodermaExtraData);

      } catch (error) {
        console.error('loadProductDetail Hatası:', error);
        detailContainer.innerHTML = `<div class="error-container"><h2>Hata</h2><p>Ürün yüklenirken bir sorun oluştu.</p></div>`;
      }
    }

    function displayProductDetail(product, localDetails, translatedDetails) {
        const detailContainer = document.getElementById('productDetailContainer');
        
        const productName = translatedDetails?.name || product.ProductName;
        const description = translatedDetails?.description || localDetails?.["Ürün Açıklaması"] || "Açıklama bulunamadı.";
        const tabs = translatedDetails?.tabs || [];

        let tabsNavHTML = '';
        let tabsContentHTML = '';

        if (description) {
            tabsNavHTML += `<button class="tab-link-modern active" data-tab="tab-desc">Açıklama</button>`;
            tabsContentHTML += `<div id="tab-desc" class="tab-pane-modern active"><h3>Ürün Açıklaması</h3><p>${description}</p></div>`;
        }

        tabs.forEach((tab, index) => {
            const tabId = `tab-${tab.id || index}`;
            tabsNavHTML += `<button class="tab-link-modern" data-tab="${tabId}">${tab.title}</button>`;
            tabsContentHTML += `<div id="${tabId}" class="tab-pane-modern">${tab.html}</div>`;
        });

        detailContainer.innerHTML = `
            <div class="product-main-layout">
                <div class="product-gallery-modern">
                    <img src="${product.ImageUrl || FALLBACK_IMAGE_URL}" alt="${productName}" class="product-main-image-modern" onerror="this.src='${FALLBACK_IMAGE_URL}'">
                </div>
                <div class="product-info-modern">
                    <h1 class="product-title-modern">${productName}</h1>
                    <div class="product-short-description">${description}</div>
                </div>
            </div>
            ${tabsNavHTML ? `
            <div class="product-details-tabs-modern">
                <div class="tabs-navigation-modern">${tabsNavHTML}</div>
                <div class="tab-content-modern">${tabsContentHTML}</div>
            </div>` : ''}
        `;
        
        // Tab tıklama olaylarını yeniden bağla
        const tabLinks = detailContainer.querySelectorAll('.tab-link-modern');
        const tabPanes = detailContainer.querySelectorAll('.tab-pane-modern');
        tabLinks.forEach(link => {
            link.addEventListener('click', () => {
                const targetTab = link.dataset.tab;
                tabLinks.forEach(l => l.classList.remove('active'));
                tabPanes.forEach(p => p.classList.remove('active'));
                link.classList.add('active');
                detailContainer.querySelector(`#${targetTab}`).classList.add('active');
            });
        });
    }

    // --- OLAY DİNLEYİCİLER (EVENT LISTENERS) ---

    // Dil değiştirme butonlarına olay dinleyicisi ekle
    // Not: Bu kod, i18n.js dosyanızın document.documentElement.lang değerini değiştirip
    // 'languageChanged' olayını tetiklediğini varsayar.
    // Eğer i18n.js dosyanız bu şekilde çalışmıyorsa, bu kısmı ona göre uyarlamanız gerekir.
    document.querySelectorAll('.language-selector').forEach(button => {
        button.addEventListener('click', () => {
            const lang = button.dataset.lang;
            // Bu varsayımsal bir fonksiyondur, i18n.js'deki fonksiyonunuzla değiştirin
            if(window.changeLanguage) {
                window.changeLanguage(lang);
            } else {
                // Basit bir fallback
                document.documentElement.lang = lang;
                window.dispatchEvent(new CustomEvent('languageChanged'));
            }

            // Aktif buton stilini ayarla
            document.querySelectorAll('.language-selector').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        });
    });

    // Dil değiştiğinde sayfayı güncelle
    window.addEventListener('languageChanged', async () => {
        if (currentProduct) {
            console.log("Dil değişti, ürün detayları güncelleniyor...");
            const newLang = document.documentElement.lang || 'tr';
            const detailContainer = document.getElementById('productDetailContainer');
            
            if (detailContainer) detailContainer.style.opacity = '0.5';

            let biodermaExtraData = null;
            if (currentProduct.brand?.toLowerCase() === 'bioderma') {
                 const biodermaResponse = await loadBiodermaData(newLang);
                 biodermaExtraData = findBiodermaExtra(biodermaResponse, currentProduct);
            }
            
            displayProductDetail(currentProduct, productDetail, biodermaExtraData);
            
            if (detailContainer) {
                setTimeout(() => { detailContainer.style.opacity = '1'; }, 150);
            }
        }
    });

    // Sayfa ilk yüklendiğinde çalışacak kod
    document.addEventListener('DOMContentLoaded', () => {
        const slugStr = getSlugFromUrl(); 
        if (slugStr) {
            loadProductDetail(slugStr);
        } else {
            document.getElementById('productDetailContainer').innerHTML = `<div class="error-container"><h2>Ürün Belirtilmedi</h2><p>Lütfen bir ürün seçerek devam edin.</p></div>`;
        }

        // Başlangıçta aktif dil butonunu ayarla
        const currentLang = document.documentElement.lang || 'tr';
        const activeButton = document.querySelector(`.language-selector[data-lang="${currentLang}"]`);
        if(activeButton) {
            activeButton.classList.add('active');
        }
    });

  </script>
</body>
</html>
