<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ürün Detayı | Dermokozmetik | Serakıncı</title>
  <meta name="description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  <link rel="canonical" href="https://www.serakinci.com/">

  <link rel="icon" href="/urunler/assets/logos/logobrowser/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="16x16" href="/urunler/assets/logos/logobrowser/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/urunler/assets/logos/logobrowser/favicon-32x32.png">
  <link rel="apple-touch-icon" href="/urunler/assets/logos/logobrowser/apple-icon.png">
  <link rel="apple-touch-icon" sizes="57x57" href="/urunler/assets/logos/logobrowser/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/urunler/assets/logos/logobrowser/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/urunler/assets/logos/logobrowser/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/urunler/assets/logos/logobrowser/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/urunler/assets/logos/logobrowser/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/urunler/assets/logos/logobrowser/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/urunler/assets/logos/logobrowser/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/urunler/assets/logos/logobrowser/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/urunler/assets/logos/logobrowser/apple-icon-180x180.png">
  <link rel="apple-touch-icon-precomposed" href="/urunler/assets/logos/logobrowser/apple-icon-precomposed.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/urunler/assets/logos/logobrowser/android-icon-192x192.png">
  <meta name="msapplication-TileColor" content="#212A40">
  <meta name="msapplication-TileImage" content="/urunler/assets/logos/logobrowser/android-icon-144x144.png">
  <meta name="msapplication-config" content="/urunler/assets/logos/logobrowser/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="/urunler/assets/logos/logobrowser/manifest.json">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Yükleniyor...",
    "description": "Yükleniyor...",
    "image": "",
    "offers": {
      "@type": "Offer",
      "priceCurrency": "TRY",
      "price": "0.00",
      "availability": "https://schema.org/InStock"
    },
    "brand": {
      "@type": "Brand",
      "name": "Yükleniyor..."
    }
  }
  </script>
  <meta property="og:title" content="Ürün Detayı | Dermokozmetik | Serakıncı">
  <meta property="og:description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  <meta property="og:type" content="og:product">
  <meta property="og:url" content="">
  <meta property="og:site_name" content="Serakıncı">
  <meta property="og:locale" content="tr_TR">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ürün Detayı | Dermokozmetik | Serakıncı">
  <meta name="twitter:description" content="Serakıncı'da dermokozmetik ürünleri. En sevdiğiniz markaların ürün detaylarını inceleyin.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Satoshi:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script type="importmap">
  {
    "imports": {
      "@google/genai": "https://esm.sh/@google/generative-ai"
    }
  }
  </script>

  <style>
    :root {
      --primary-theme: #50C8C6; 
      --primary-theme-hover: #40A8A6;
      --accent: #f97316; 
      
      --background: #f8f9fa;
      --card-bg: #ffffff;
      --text-dark: #212529;
      --text-medium: #495057;
      --text-light: #6c757d;
      --border-color: #dee2e6;
      --radius: 0.375rem;
      --shadow-sm: 0 .125rem .25rem rgba(0,0,0,.075);
      --shadow-md: 0 .5rem 1rem rgba(0,0,0,.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);

      --header-bg: #ffffff;
      --header-text-color: #1C274C;
      --header-nav-link-color: #1C274C;
      --header-nav-link-hover-color: #50C8C6; 
      --header-b2b-button-bg: #212A40;
      --header-b2b-button-text: #ffffff;
      --header-b2b-button-hover-bg: #303E5C;
      --header-border-color: #e0e6e8;
    }
    html { scroll-behavior: smooth; box-sizing: border-box; }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: inherit; overflow-wrap: break-word; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: var(--text-dark); background-color: var(--background); line-height: 1.6; overflow-x: hidden; -webkit-font-smoothing:antialiased; }
    img, svg, video, canvas, iframe, embed, object { max-width: 100%; height: auto; display: block; }
    .container { max-width: 1140px; margin: 0 auto; padding: 1.5rem 1rem; }
    @media (max-width: 767px) { .container { padding: 1rem 0.75rem; } }

    .new-site-header { font-family: 'Satoshi', sans-serif; background-color: var(--header-bg); padding: 0.8rem 0; border-bottom: 1px solid var(--header-border-color); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 1030; }
    .new-header-content { display: flex; justify-content: space-between; align-items: center; margin: 0 auto; padding: 0 1.5rem; max-width:1100px; }
    .new-site-logo-link { display: flex; align-items: center; text-decoration: none; flex-shrink: 0; }
    .new-site-logo-img { height: 36px; margin-right: 0.6rem; }
    .new-site-logo-text { font-size: 1.3rem; font-weight: 500; color: var(--header-text-color); }
    .new-site-navigation { display: flex; gap: 1.5rem; margin-left: auto; margin-right: 1.5rem;}
    .new-nav-link { color: var(--header-nav-link-color); text-decoration: none; font-weight: 500; font-size: 0.9rem; padding: 0.3rem 0; position: relative; transition: color 0.2s ease; cursor: pointer; white-space: nowrap; }
    .new-nav-link:hover { color: var(--header-nav-link-hover-color); }
    .new-nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -2px; left: 0; background-color: var(--header-nav-link-hover-color); transition: width 0.3s ease; }
    .new-nav-link:hover::after { width: 100%; }
    .new-header-actions { display: flex; align-items: center; gap: 1rem; flex-shrink: 0;}
    .language-selector {
      background-color: var(--header-lang-button-bg);
      border: 1px solid var(--header-lang-button-border);
      color: var(--header-lang-button-text);
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .language-selector:hover { background-color: var(--header-lang-button-hover-bg); }
    
    .header-search-wrapper { position: relative; min-width: 180px; max-width: 250px; transition: max-width 0.3s ease-in-out, flex-grow 0.3s ease-in-out; }
    .header-search-wrapper.search-active { flex-grow: 2; max-width: 400px; z-index: 1005; }
    .header-search-wrapper .search-input-wrapper { display: flex; align-items: center; background-color: #f1f3f5; border-radius: var(--radius); padding: 0.25rem 0.75rem; border: 1px solid transparent; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
    .header-search-wrapper.search-active .search-input-wrapper { border-color: var(--primary-theme); box-shadow: 0 0 0 2px rgba(80, 200, 198, 0.25); }
    .header-search-wrapper .search-input-wrapper svg { margin-right: 0.5rem; color: var(--text-light); width: 18px; height: 18px; flex-shrink: 0;}
    #headerProductSearchInput { width: 100%; border: none; outline: none; font-size: 0.9rem; padding: 0.4rem 0; background-color: transparent; color: var(--text-dark); }
    #headerProductSearchInput::placeholder { color: var(--text-light); }
    #headerSearchResultsDropdown { position: absolute; top: calc(100% + 2px); left: 0; right: 0; background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--radius); box-shadow: var(--shadow-md); max-height: 300px; overflow-y: auto; z-index: 1035; display: none; }
    #headerSearchResultsDropdown ul { list-style: none; padding: 0; margin: 0; }
    #headerSearchResultsDropdown li a { display: flex; align-items: center; padding: 0.8rem 1rem; text-decoration: none; color: var(--text-dark); border-bottom: 1px solid var(--border-color); transition: background-color 0.2s; }
    #headerSearchResultsDropdown li:last-child a { border-bottom: none; }
    #headerSearchResultsDropdown li a:hover { background-color: #f1f3f5; }
    #headerSearchResultsDropdown .suggestion-image { width: 30px; height: 30px; object-fit: contain; margin-right: 0.8rem; border-radius: 3px; flex-shrink: 0; }
    #headerSearchResultsDropdown .suggestion-name { font-weight: 500; font-size:0.85rem; flex-grow: 1; white-space: normal; line-height: 1.3; }
    #headerSearchResultsDropdown .suggestion-category { font-size: 0.75rem; color: var(--text-light); margin-left: 0.5rem; white-space: nowrap; flex-shrink: 0;}
    #headerSearchResultsDropdown .no-results { padding: 0.75rem 1rem; text-align: center; color: var(--text-medium); font-size:0.85rem; }
    
    .b2b-login-button { background-color: var(--header-b2b-button-bg); color: var(--header-b2b-button-text); padding: 0.5rem 1.2rem; border-radius: 20px; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: background-color 0.2s ease; white-space: nowrap; }
    .b2b-login-button:hover { background-color: var(--header-b2b-button-hover-bg); }
    .mobile-menu-toggle { display: none; background: none; border: none; cursor: pointer; padding: 0.5rem; }
    .mobile-menu-toggle svg { width: 24px; height: 24px; stroke: var(--header-text-color); }
    
    .favorites-count { background-color: var(--accent); color: white; border-radius: 50%; font-size: 0.75em; padding: 0.2em 0.5em; line-height: 1; font-weight: bold; min-width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; }
    #favoritesNavLink { position: fixed; bottom: calc(80px + 56px + 10px); right: 20px; background-color: var(--card-bg); border: 1px solid var(--border-color); color: var(--primary-theme); padding: 0.6rem 1rem; border-radius: 20px; box-shadow: var(--shadow-md); text-decoration: none; font-weight: 500; font-size: 0.9rem; z-index: 1001; display: inline-flex !important; align-items: center; gap: 0.5em; transition: all 0.2s ease; white-space: nowrap; cursor: pointer; }
    #favoritesNavLink:hover { background-color: var(--primary-theme-hover); border-color: var(--primary-theme-hover); color: white; transform: translateY(-2px) scale(1.05); box-shadow: var(--shadow-lg); }
    #favoritesNavLink::after { display: none !important; }
    .new-site-navigation #favoritesNavLink { display: none !important; }

    .chatbot-floating-btn { position: fixed; right: 20px; background-color: var(--primary-theme); color: white; border: none; border-radius: 50%; width: 56px; height: 56px; align-items: center; justify-content: center; cursor: pointer; z-index: 1001; box-shadow: var(--shadow-md); transition: transform 0.3s; }
    .chatbot-floating-btn { bottom: 80px; background-color: var(--accent); display: flex; }
    .chatbot-floating-btn:hover { transform: scale(1.1); }
    .chatbot-floating-btn svg { width: 28px; height: 28px; }
    
    @media(max-width: 992px) { 
        .new-site-navigation { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; right: 0; background-color: var(--header-bg); padding: 1rem; box-shadow: var(--shadow-md); z-index: 1025; border-top: 1px solid var(--header-border-color); margin-left: 0; margin-right: 0; } 
        .new-site-navigation.is-active { display: flex; } 
        .mobile-menu-toggle { display: block; } 
        .header-search-wrapper { display:none; } 
    }
    
    .product-search-header { background-color: var(--card-bg); padding: 1rem 0; box-shadow: var(--shadow-sm); margin-bottom: 1.5rem; }
    .search-bar-container { max-width: 700px; margin: 0 auto; padding: 0 1rem; position: relative; }
    .search-bar-container .search-input-wrapper { display: flex; align-items: center; background-color: #f1f3f5; border-radius: var(--radius); padding: 0.5rem 1rem; border: 1px solid var(--border-color); }
    .search-bar-container .search-input-wrapper svg { margin-right: 0.75rem; color: var(--text-light); width: 20px; height: 20px; flex-shrink: 0; }
    #productSearchInput { width: 100%; border: none; outline: none; font-size: 1rem; padding: 0.5rem 0; background-color: transparent; color: var(--text-dark); }
    #productSearchInput::placeholder { color: var(--text-light); }
    #searchResultsDropdown { position: absolute; top: calc(100% + 5px); left: 0; right: 0; background-color: var(--card-bg); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 var(--radius) var(--radius); box-shadow: var(--shadow-md); max-height: 350px; overflow-y: auto; z-index: 1010; display: none; }
    #searchResultsDropdown ul { list-style: none; padding: 0; margin: 0; }
    #searchResultsDropdown li a { display: flex; align-items: center; padding: 0.75rem 1rem; text-decoration: none; color: var(--text-dark); border-bottom: 1px solid var(--border-color); transition: background-color 0.2s; }
    #searchResultsDropdown li:last-child a { border-bottom: none; }
    #searchResultsDropdown li a:hover { background-color: #e9ecef; }
    #searchResultsDropdown .suggestion-image { width: 40px; height: 40px; object-fit: contain; margin-right: 0.75rem; border-radius: var(--radius); border: 1px solid var(--border-color); background-color: #fff; }
    #searchResultsDropdown .suggestion-name { font-weight: 500; flex-grow: 1; }
    #searchResultsDropdown .suggestion-category { font-size: 0.8rem; color: var(--text-light); margin-left: 0.5rem; white-space: nowrap; }
    #searchResultsDropdown .no-results { padding: 1rem; text-align: center; color: var(--text-medium); }

    .breadcrumbs { display: flex; align-items: center; flex-wrap: wrap; font-size: 0.875rem; margin-bottom: 1.5rem; padding: 0.5rem 0; color: var(--text-medium); }
    .breadcrumb-link { color: var(--primary-theme); text-decoration: none; transition: color 0.2s; }
    .breadcrumb-link:hover { text-decoration: underline; color: var(--primary-theme-hover); }
    .breadcrumb-separator { margin: 0 0.5rem; color: var(--text-light); font-size: 0.9em; }
    .breadcrumb-current { color: var(--text-dark); font-weight: 500; }
    .product-main-layout { display: grid; grid-template-columns: 1fr; gap: 2.5rem; margin-bottom: 2.5rem; background-color: var(--card-bg); padding: 2rem; border-radius: var(--radius); box-shadow: var(--shadow-md); }
    @media (min-width: 768px) { .product-main-layout { grid-template-columns: 2fr 3fr; gap: 2rem; } }
    @media (min-width: 992px) { .product-main-layout { grid-template-columns: 1fr 2fr; gap: 2.5rem; } }
    
    .product-gallery-modern { display: flex; flex-direction: column; align-items: center; }
    .product-gallery-modern .product-main-image-wrapper { cursor: pointer; width: 100%; border: 1px solid var(--border-color); border-radius: var(--radius); overflow: hidden; background-color: #fff; box-shadow: var(--shadow-sm); margin-bottom: 1rem; }
    .product-main-image-modern { display: block; width: 100%; height: auto; aspect-ratio: 1 / 1; object-fit: contain; padding: 0.5rem; }
    .product-thumbnails { display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem; justify-content: center; max-width: 100%;}
    .product-thumbnails img { width: 60px; height: 60px; object-fit: contain; border: 2px solid var(--border-color); border-radius: var(--radius); cursor: pointer; transition: border-color 0.2s; }
    .product-thumbnails img:hover, .product-thumbnails img.active-thumbnail { border-color: var(--primary-theme); }


    .product-info-modern { display: flex; flex-direction: column; }
    .product-title-wrapper { display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 0.75rem;}
    .product-title-modern { font-size: 2rem; font-weight: 700; color: var(--text-dark); line-height: 1.3; margin:0 0.5rem 0 0; }
    .favorite-button { background: none; border: none; cursor: pointer; padding: 0.3rem; color: var(--text-light); transition: color 0.2s, transform 0.2s; display: inline-flex; align-items: center; }
    .favorite-button svg { width: 24px; height: 24px; fill: currentColor; }
    .favorite-button:hover { color: #e74c3c; transform: scale(1.1); }
    .favorite-button.favorited { color: #e74c3c; }
    .favorite-tooltip, .copy-tooltip { position: fixed; background-color: #333; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8em; z-index: 1070; opacity: 0; transition: opacity 0.3s, transform 0.3s; pointer-events: none; white-space: nowrap; transform: translateY(10px); }
    .favorite-tooltip.show, .copy-tooltip.show { opacity: 1; transform: translateY(0); } 
    .product-meta-enhanced { font-size: 0.9rem; color: var(--text-medium); margin-bottom: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem; }
    .product-meta-enhanced .meta-item { display: flex; align-items: center; }
    .product-meta-enhanced .meta-item strong { color: var(--text-dark); font-weight: 600; margin-right: 0.3rem; }
    .product-meta-enhanced .meta-item .copy-code { margin-left: 0.5rem; cursor: pointer; color: var(--primary-theme); font-size: 0.85em; border: 1px solid transparent; padding: 0.1rem 0.2rem; border-radius: 0.2rem; }
    .product-meta-enhanced .meta-item .copy-code:hover { color: var(--primary-theme-hover); background-color: #e9f4ff; }
    .product-share-buttons { margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; }
    .product-share-buttons .share-label { font-size: 0.9rem; font-weight: 500; color: var(--text-medium); margin-right: 0.25rem; }
    .product-share-buttons a { display: inline-flex; align-items:center; justify-content:center; transition: opacity 0.2s, transform 0.2s; width: 28px; height: 28px; }
    .product-share-buttons a:hover { opacity: 0.7; transform: scale(1.1); }
    .product-share-buttons svg { width: 100%; height: 100%; } 
    .product-short-description { font-size: 1rem; color: var(--text-medium); margin-bottom: 1rem; line-height: 1.7; }
    #ai-button-container { margin-top: 1.5rem; display: flex; flex-wrap: wrap; gap: 10px; }
    #scrollToContactBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: auto;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      transition: all 0.2s;
      border: 1px solid;
      border-radius: var(--radius);
      cursor: pointer;
      background-color: var(--primary-blue);
      border-color: var(--primary-blue);
      color: white;
    }
    #scrollToContactBtn:hover {
      background-color: var(--primary-blue-hover);
      border-color: var(--primary-blue-hover);
    }
    #scrollToContactBtn svg {
      width:20px;
      height:20px;
      margin-right: 8px;
    }
    .product-details-tabs-modern { background-color: var(--card-bg); padding: 0; border-radius: var(--radius); box-shadow: var(--shadow-md); margin-bottom: 2.5rem; overflow: hidden; }
    .tabs-navigation-modern { display: flex; border-bottom: 1px solid var(--border-color); background-color: #f8f9fa; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: var(--primary-theme) #f1f3f5; }
    .tabs-navigation-modern::-webkit-scrollbar { height: 6px; }
    .tabs-navigation-modern::-webkit-scrollbar-thumb { background-color: var(--primary-theme); border-radius: 3px; }
    .tabs-navigation-modern::-webkit-scrollbar-track { background-color: #f1f3f5; }
    .tab-link-modern { font-family: 'Inter', sans-serif; padding: 1rem 1.5rem; cursor: pointer; border: none; background-color: transparent; color: var(--text-medium); font-size: 1rem; font-weight: 600; position: relative; border-bottom: 3px solid transparent; transition: color 0.2s, border-color 0.2s, background-color 0.2s; margin-bottom: -1px; flex-shrink: 0;}
    .tab-link-modern:hover { color: var(--primary-theme); background-color: #e9ecef; text-decoration: none; }
    .tab-link-modern.active { color: var(--primary-theme); border-bottom-color: var(--primary-theme); background-color: var(--card-bg); }
    .tab-content-modern { padding: 1.5rem 2rem; }
    .tab-pane-modern { display: none; line-height: 1.7; font-size: 0.9375rem; color: var(--text-medium); }
    .tab-pane-modern.active { display: block; }
    .tab-pane-modern h3 { font-size: 1.25rem; font-weight: 700; color: var(--text-dark); margin-top: 0; margin-bottom: 1rem; }
    .tab-pane-modern p, .tab-pane-modern div, .tab-pane-modern ul { margin-bottom: 1rem; }
    .tab-pane-modern ul { padding-left: 1.5rem; }
    .tab-pane-modern strong { font-weight: 600; color: var(--text-dark); }
    .toggle-content { max-height: 100px; overflow: hidden; position: relative; transition: max-height 0.5s ease-in-out; }
    .toggle-content.expanded { max-height: 2000px; }
    .toggle-content::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 30px; background: linear-gradient(to bottom, transparent, var(--card-bg)); pointer-events: none; opacity: 1; transition: opacity 0.3s; }
    .toggle-content.expanded::after { opacity: 0; }
    .read-more-btn { display: inline-block; margin-top: 0.75rem; padding: 0.4rem 0.8rem; font-size: 0.875rem; color: var(--primary-theme); background-color: transparent; border: 1px solid var(--primary-theme); border-radius: var(--radius); cursor: pointer; transition: background-color 0.2s, color 0.2s; font-weight: 500; }
    .read-more-btn:hover { background-color: var(--primary-theme); color: white; text-decoration: none; }
    
    /* İçindekiler (Bioderma için) */
    .ingredients-section { margin-top: 1.5rem; }
    .ingredients-section h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem; }
    .ingredients-section ul { list-style: none; padding: 0; column-count: 2; column-gap: 20px; font-size: 0.9rem; }
    .ingredients-section li { margin-bottom: 0.3rem; }
    @media (max-width: 576px) { .ingredients-section ul { column-count: 1; } }
    .ingredients-section .ask-naos-link { margin-top: 1rem; }
    .ingredients-section .ask-naos-link a { color: var(--primary-theme); font-weight: 500; text-decoration: underline; }
    .ingredients-section .ingredients-disclaimer { font-size: 0.8rem; color: var(--text-light); margin-top: 1rem; }

    /* Brand attribute tables (Ürün Özellikleri) */
    .table-responsive { width: 100%; overflow-x: auto; margin-bottom: 1rem; }
    .table-responsive table { width: 100%; border-collapse: collapse; margin-bottom: .75rem; }
    .table-responsive caption { text-align: left; font-weight: 600; padding-bottom: .25rem; color: var(--text-dark); }
    .table-responsive th, .table-responsive td { padding: .5rem; border: 1px solid var(--border-color); text-align: left; }
    .table-responsive th { background-color: #F3F3F3; font-weight: 500; }
    .table-responsive h3 { margin: 0; font-size: 1rem; }


    /* Bioderma tablarındaki modal ve accordion için temel stiller */
    .tab-pane-modern .card { border: 1px solid var(--border-color); margin-bottom: 0.5rem; border-radius: var(--radius); }
    .tab-pane-modern .card button[data-toggle="collapse"] { background-color: #f8f9fa; border: none; padding: 0.75rem 1rem; width: 100%; text-align: left; font-weight: 600; color: var(--text-dark); cursor: pointer; border-radius: var(--radius) var(--radius) 0 0; position: relative; }
    .tab-pane-modern .card button[data-toggle="collapse"]::after { content: '+'; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); font-size: 1.2rem; }
    .tab-pane-modern .card button[data-toggle="collapse"][aria-expanded="true"]::after { content: '−'; }
    .tab-pane-modern .card .collapse { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    .tab-pane-modern .card .collapse.show { max-height: 1000px; /* Yeterince büyük bir değer */ }
    .tab-pane-modern .card .card-body { padding: 1rem; border-top: 1px solid var(--border-color); }
    .tab-pane-modern .card .card-body p { margin-bottom: 0.5rem; }
    .tab-pane-modern .card .card-body ul { margin-top: 0.5rem; padding-left: 1.2rem; }
    .tab-pane-modern .modal { display: none; position: fixed; z-index: 1060; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
    .tab-pane-modern .modal.show { display: flex; align-items: center; justify-content: center; }
    .tab-pane-modern .modal-content { background-color: #fff; margin: auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: var(--radius); position: relative; }
    .tab-pane-modern .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1rem; }
    .tab-pane-modern .modal-title { font-size: 1.25rem; font-weight: 600; }
    .tab-pane-modern .modal-body p { font-size: 0.9rem; }
    .tab-pane-modern .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; background: none; border: none; cursor: pointer; }
    .tab-pane-modern .close:hover, .tab-pane-modern .close:focus { color: black; text-decoration: none; cursor: pointer; }
    .tab-pane-modern .underline { text-decoration: underline; color: var(--primary-theme); }
    .tab-pane-modern .underline:hover { color: var(--primary-theme-hover); }
    .tab-pane-modern .btn-secondary { background-color: var(--primary-theme); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--radius); text-decoration: none; display: inline-block; margin-top: 0.5rem; }
    .tab-pane-modern .btn-secondary:hover { background-color: var(--primary-theme-hover); }


    .related-products-section-modern { margin-bottom: 2.5rem; }
    .related-products-title-modern { font-size: 1.75rem; font-weight: 700; color: var(--text-dark); margin-bottom: 1.5rem; text-align: left; padding-bottom: 0.75rem; border-bottom: 2px solid var(--primary-theme); display: inline-block; }
    .related-products-carousel { position: relative; }
    .related-products-container { display: flex; overflow-x: auto; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; padding-bottom: 1rem; gap: 1.5rem; scrollbar-width: none; -ms-overflow-style: none; }
    .related-products-container::-webkit-scrollbar { display: none; }
    .related-product-card { flex: 0 0 auto; width: 240px; background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--radius); box-shadow: var(--shadow-sm); overflow: hidden; text-decoration: none; color: var(--text-dark); transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; }
    .related-product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); text-decoration: none; }
    .related-product-card img { width: 100%; height: 180px; object-fit: contain; padding: 0.5rem; border-bottom: 1px solid var(--border-color); background-color: #fff; }
    .related-product-card .info { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
    .related-product-card .name { font-size: 0.9375rem; font-weight: 600; margin-bottom: 0.25rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.8em; line-height: 1.4em; }
    .related-product-card .category { font-size: 0.8rem; color: var(--text-light); margin-top: auto; }
    .carousel-arrow { position: absolute; top: calc(50% - 10px); transform: translateY(-50%); background-color: rgba(255, 255, 255, 0.95); border: 1px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; box-shadow: var(--shadow-sm); transition: background-color 0.2s, transform 0.2s; }
    .carousel-arrow:hover { background-color: white; transform: translateY(-50%) scale(1.05); }
    .carousel-arrow.prev { left: -15px; }
    .carousel-arrow.next { right: -15px; }
    .carousel-arrow svg { width: 20px; height: 20px; color: var(--text-dark); }
    .lightbox-modal, .modal { display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
    .lightbox-modal.show, .modal.show { display: flex; }
    .lightbox-content { margin: auto; display: block; max-width: 90vw; max-height: 90vh; animation: lightboxZoom 0.3s ease-out; border-radius: var(--radius); }
    @keyframes lightboxZoom { from {transform: scale(0.8) translateY(20px); opacity: 0;} to {transform: scale(1) translateY(0); opacity: 1;} }
    .lightbox-close { position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; user-select: none; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    .lightbox-close:hover { color: #bbb; }
    .modal-content { background-color: var(--card-bg); margin: 10% auto; padding: 30px; border-radius: var(--radius); width: 80%; max-width: 600px; position: relative; box-shadow: var(--shadow-lg); animation: modalFadeIn 0.3s ease-out; }
    @keyframes modalFadeIn { from {opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }
    .modal .close-button { position: absolute; top: 15px; right: 25px; color: var(--text-light); font-size: 30px; font-weight: bold; transition: 0.3s; cursor: pointer; user-select: none; }
    .modal .close-button:hover { color: #bbb; }
    .modal-content h2, .modal-content h3 { color: var(--text-dark); margin-top: 0; margin-bottom: 20px; font-size: 1.8rem; }
    .modal-list { max-height: 400px; overflow-y: auto; margin-bottom: 20px; }
    .modal-list-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
    .modal-list-item:last-child { border-bottom: none; }
    .modal-list-item img { width: 60px; height: 60px; object-fit: contain; margin-right: 15px; border-radius: var(--radius); }
    .modal-list-item-info { flex-grow: 1; }
    .modal-list-item-info .name { font-weight: 600; font-size: 1.1rem; color: var(--text-dark); display: block; margin-bottom: 5px;}
    .modal-list-item-info .category { font-size: 0.85rem; color: var(--text-medium); display: block; }
    .modal-list-item a { text-decoration: none;}
    .modal-list-item-actions { display: flex; gap: 10px; }
    .modal-list-item-actions button { background: none; border: none; cursor: pointer; padding: 5px; color: var(--text-light); transition: color 0.2s; }
    .modal-list-item-actions button:hover { color: #e74c3c; }
    .no-favorites-message { text-align: center; color: var(--text-medium); padding: 20px 0; }
    .chatbot-modal .modal-content { max-width: 500px; padding: 0; overflow: hidden;}
    .chatbot-modal h3 { background-color: var(--accent); color: white; padding: 15px 20px; margin: 0; font-size: 1.3rem;}
    .chatbot-messages { height: 350px; overflow-y: auto; padding: 20px; background-color: #f9f9f9; }
    .bot-message, .user-message { padding: 10px 15px; border-radius: 15px; margin-bottom: 10px; max-width: 80%; line-height: 1.4; }
    .bot-message { background-color: #e9ecef; color: var(--text-dark); float: left; clear: both; }
    .user-message { background-color: var(--primary-theme); color: white; float: right; clear: both; }
    .chatbot-input-container { display: flex; border-top: 1px solid var(--border-color); padding: 15px; }
    #chatbotInput { flex-grow: 1; border: 1px solid var(--border-color); border-radius: 20px; padding: 10px 15px; outline: none; margin-right: 10px; }
    .chatbot-send-btn { background-color: var(--primary-theme); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background-color 0.2s; }
    .chatbot-send-btn:hover { background-color: var(--primary-theme-hover); }
    .chatbot-send-btn svg { width: 20px; height: 20px; }
    .bot-message.typing::after { content: '...'; display: inline-block; animation: typing-dots 1s infinite steps(3, end); }
    @keyframes typing-dots { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } } 
    .scroll-to-top { position: fixed; bottom: 20px; right: 20px; background-color: var(--primary-theme); color: white; border: none; border-radius: 50%; width: 48px; height: 48px; font-size: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s, transform 0.3s; z-index: 999; box-shadow: var(--shadow-md); transform: translateY(20px); }
    .scroll-to-top.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .scroll-to-top:hover { background-color: var(--primary-theme-hover); }
    .loading-container, .error-container { text-align: center; padding: 3rem 1rem; background-color: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow-md); max-width: 600px; margin: 3rem auto; }
    .loading-spinner { width: 48px; height: 48px; border: 4px solid #e9ecef; border-top: 4px solid var(--primary-theme); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1.5rem auto; }
    .loading-text { color: var(--text-medium); font-size: 1rem; }
    .error-container h2 { font-size: 1.5rem; color: var(--text-dark); margin-bottom: 0.5rem;}
    .error-container p { font-size: 1rem; color: var(--text-medium); margin-bottom: 1.5rem;}
    .back-button-modern { display: inline-flex; align-items: center; color: var(--primary-theme); text-decoration: none; margin-top: 1.5rem; font-size: 0.9375rem; transition: background-color 0.2s, color 0.2s; padding: 0.6rem 1.2rem; border: 1px solid var(--primary-theme); border-radius: var(--radius); background-color: transparent; font-weight: 500; }
    .back-button-modern:hover { background-color: var(--primary-theme); color: white; text-decoration: none; }
    .back-icon { margin-right: 0.5rem; font-size: 1.1em; }
    .disclaimer-box-modern { margin-top: 2.5rem; padding: 1.5rem; background: #fff3cd; border-radius: var(--radius); border-left: 5px solid #ffe082; color: #664d03; font-size: 0.9rem; line-height: 1.6; box-shadow: var(--shadow-sm); }
    .disclaimer-box-modern b, .disclaimer-box-modern strong { font-weight: 700; }
    .disclaimer-box-modern span { display: block; margin-top: 0.75rem;}
    .disclaimer-box-modern span:first-of-type { margin-top: 0; }
    .contact-card-modern { margin-top: 2.5rem; background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow-md); padding: 2rem; max-width: none; }
    .contact-title-modern { font-weight: 700; font-size: 1.5rem; margin-bottom: 0.75rem; color: var(--text-dark); }
    .contact-bar-modern { border-bottom: 3px solid var(--primary-theme); width: 50px; margin-bottom: 1.5rem; }
    .contact-intro-text { color: var(--text-medium); margin-bottom: 1.5rem; font-size: 1rem; }
    .contact-grid { display: grid; gap: 1.5rem; }
    @media (min-width: 576px) { .contact-grid { grid-template-columns: 1fr 1fr; } }
    .contact-item { display:flex; align-items: flex-start; }
    .contact-item svg { color:var(--primary-theme); margin-right:1rem; flex-shrink:0; width: 24px; height: 24px; margin-top: 0.1rem; }
    .contact-label-modern { font-weight:600; color:var(--text-dark); font-size: 0.9375rem; display: block; margin-bottom: 0.25rem; }
    .contact-link-modern { color:var(--primary-theme); text-decoration:none; font-size:1rem;}
    .contact-link-modern:hover { text-decoration: underline; color: var(--primary-theme-hover); }
    .contact-address-text { font-size:1rem; color: var(--text-medium); line-height: 1.5; }
    .firm-social-media { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); } 
    .firm-social-media .social-label { font-weight: 600; font-size: 1.125rem; color:var(--text-dark); margin-bottom: 0.75rem; display:block; }
    .firm-social-media-row { display:flex; gap:1rem; align-items: center;}
    .firm-social-media-row a { display:inline-flex; align-items:center; justify-content:center; width: 32px; height: 32px; } 
    .firm-social-media-row a svg { width: 100%; height: 100%; transition: opacity 0.2s, transform 0.2s; }
    .firm-social-media-row a:hover svg { opacity: 0.75; transform: scale(1.1); }
    @media (max-width: 991px) { .carousel-arrow.prev { left: 5px; } .carousel-arrow.next { right: 5px; } }
    @media (max-width: 767px) { .new-header-content { padding: 0 1rem; } .new-site-navigation { gap: 1rem; } .new-nav-link { font-size: 1rem; padding: 0.8rem 0; } .new-header-actions { gap: 0.5rem; } .language-selector, .b2b-login-button { padding: 0.35rem 0.7rem; font-size: 0.8rem; } .product-main-layout { padding: 1.5rem; gap: 1.5rem; } .product-title-modern { font-size: 1.75rem; } .tab-link-modern { padding: 0.8rem 1rem; font-size: 0.9375rem; } .tab-content-modern { padding: 1.5rem; } .related-products-title-modern { font-size: 1.5rem; } .contact-card-modern { padding: 1.5rem; } .contact-grid { grid-template-columns: 1fr; } .product-meta-enhanced { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        .chatbot-floating-btn, #favoritesNavLink { display: flex !important; opacity: 1 !important; visibility: visible !important; right: 20px; }
        .chatbot-floating-btn { bottom: 80px; }
        #favoritesNavLink { bottom: calc(80px + 56px + 10px); }
        .scroll-to-top { right: 20px; bottom: 20px; }
    }
    @media (max-width: 575px) { .product-title-modern { font-size: 1.5rem; } .breadcrumb-separator { margin: 0 0.4rem; } .related-product-card { width: 200px; } .product-share-buttons { flex-wrap: wrap; gap: 0.5rem; } .tabs-navigation-modern { padding-left: 0.5rem; padding-right: 0.5rem; } .tab-link-modern { padding: 0.75rem 0.8rem; font-size: 0.9rem; } .language-selector { padding: 0.3rem 0.5rem; font-size: 0.7rem; } }
    footer { font-family: 'Satoshi', sans-serif; background-color: #ffffff; padding: 40px clamp(1.25rem, 5vw, 5rem); display: flex; justify-content: space-between; align-items: flex-start; font-size: 16px; border-top: 1px solid #e0e0e0; color: var(--header-text-color); }
    .footer-left { display: flex; flex-direction: column; max-width: 45%; } .footer-brand { display: flex; align-items: center; margin-bottom: 12px; } .footer-brand img { height: 48px; margin-right: 12px; } .footer-brand h1 { font-size: 25px; font-weight: 500; color: var(--header-text-color); margin: 0; white-space: nowrap; } .footer-slogan { font-size: 18px; color: #555555; font-weight: 400; } .footer-right { display: grid; grid-template-columns: auto auto; gap: 12px 40px; } .footer-right a { font-weight: 500; font-size: 16px; color: #474747; text-decoration: none; transition: color 0.3s ease; } .footer-right a:hover { color: var(--header-text-color); text-decoration: none; }
    .footer-bottom { font-family: 'Satoshi', sans-serif; background-color: #f9f9f9; text-align: center; padding: 20px 40px; font-size: 14px; color: #474747; border-top: 1px solid #e0e0e0; } .footer-bottom a { color: var(--header-text-color); font-weight: 500; text-decoration: none; display: inline-flex; align-items: center; } .footer-bottom a:hover { text-decoration: none; } .footer-bottom a img { height: 24px; margin-left: 8px; }
    @media (max-width: 768px) { footer { flex-direction: column; align-items: center; padding: 30px 20px; text-align: center; } .footer-left { max-width: 100%; align-items: center; margin-bottom: 30px; } .footer-brand { justify-content: center; } .footer-right { grid-template-columns: 1fr; gap: 15px; width: 100%; max-width: 280px; text-align: center; } .footer-right a { font-size: 18px; } .footer-bottom { padding: 20px; } }
    @media (max-width: 480px) { .footer-brand h1 { font-size: 22px; } .footer-slogan { font-size: 16px; } .footer-bottom { padding: 15px; font-size: 13px; } .footer-bottom a img { height: 20px; } }
    @keyframes spin { to { transform: rotate(360deg); } } 
    /* Bioderma tablarındaki modal ve accordion için temel stiller */
    .tab-pane-modern .card { border: 1px solid var(--border-color); margin-bottom: 0.5rem; border-radius: var(--radius); }
    .tab-pane-modern .card button[data-toggle="collapse"] { background-color: #f8f9fa; border: none; padding: 0.75rem 1rem; width: 100%; text-align: left; font-weight: 600; color: var(--text-dark); cursor: pointer; border-radius: var(--radius) var(--radius) 0 0; position: relative; }
    .tab-pane-modern .card button[data-toggle="collapse"]::after { content: '+'; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); font-size: 1.2rem; }
    .tab-pane-modern .card button[data-toggle="collapse"][aria-expanded="true"]::after { content: '−'; }
    .tab-pane-modern .card .collapse { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    .tab-pane-modern .card .collapse.show { max-height: 1000px; /* Yeterince büyük bir değer */ }
    .tab-pane-modern .card .card-body { padding: 1rem; border-top: 1px solid var(--border-color); }
    .tab-pane-modern .card .card-body p { margin-bottom: 0.5rem; }
    .tab-pane-modern .card .card-body ul { margin-top: 0.5rem; padding-left: 1.2rem; }
    .tab-pane-modern .modal[id*="-source-modal"] { /* Bioderma tablarındaki modal stilleri */ display: none; position: fixed; z-index: 1060; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
    .tab-pane-modern .modal[id*="-source-modal"].show { display: flex; align-items: center; justify-content: center; }
    .tab-pane-modern .modal[id*="-source-modal"] .modal-content { background-color: #fff; margin: auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: var(--radius); position: relative; }
    .tab-pane-modern .modal[id*="-source-modal"] .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1rem; }
    .tab-pane-modern .modal[id*="-source-modal"] .modal-title { font-size: 1.25rem; font-weight: 600; }
    .tab-pane-modern .modal[id*="-source-modal"] .modal-body p { font-size: 0.9rem; }
    .tab-pane-modern .modal[id*="-source-modal"] .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; background: none; border: none; cursor: pointer; }
    .tab-pane-modern .modal[id*="-source-modal"] .close:hover, .product-details-tabs-modern .modal[id*="-source-modal"] .close:focus { color: black; text-decoration: none; cursor: pointer; }
    .tab-pane-modern .underline { text-decoration: underline; color: var(--primary-theme); }
    .tab-pane-modern .underline:hover { color: var(--primary-theme-hover); }
    .tab-pane-modern .btn-secondary { background-color: var(--primary-theme); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--radius); text-decoration: none; display: inline-block; margin-top: 0.5rem; }
    .tab-pane-modern .btn-secondary:hover { background-color: var(--primary-theme-hover); }

  </style>
</head>
<body>
  <header class="new-site-header" id="newSiteHeader">
    <div class="new-header-content main-container">
      <a href="https://www.serakinci.com" class="new-site-logo-link" title="Serakıncı Ana Sayfa">
        <img src="/urunler/assets/logos/logo.png" alt="Serakıncı Logo" class="new-site-logo-img">
        <span class="new-site-logo-text" data-i18n="headerLogoText">Serakıncı Limited</span>
      </a>
      <nav class="new-site-navigation">
        <a href="https://serakinci.com/bizkimiz" class="new-nav-link" data-i18n="navBizKimiz">Biz Kimiz?</a>
        <a href="https://serakinci.com/services" class="new-nav-link" data-i18n="navHizmetlerimiz">Hizmetlerimiz</a>
        <a href="/urunler/" class="new-nav-link" data-i18n="navUrunler">Ürünler</a>
        <a href="https://serakinci.com/careers" class="new-nav-link" data-i18n="navKariyer">Kariyer</a>
        <a href="https://serakinci.com/contact" class="new-nav-link" data-i18n="navBizeUlasin">Bize Ulaşın</a>
      </nav>
      <div class="new-header-actions">
        <div class="header-search-wrapper">
            <div class="search-input-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="headerProductSearchInput" placeholder="Tüm ürünlerde ara..." data-i18n="headerSearchPlaceholder">
            </div>
            <div id="headerSearchResultsDropdown">
                <ul id="headerSearchResultsList"></ul>
            </div>
        </div>
        <button class="language-selector" aria-label="Dil Seçimi" data-i18n="langButtonText">Türkçe</button>
        <a href="https://siparis.serakinci.com/" class="b2b-login-button" data-i18n="b2bLoginButtonText">B2B Giriş</a>
        <button class="mobile-menu-toggle" aria-label="Menüyü Aç/Kapat" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="product-detail-page">
    <div class="product-search-header">
      <div class="search-bar-container">
        <div class="search-input-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input type="text" id="productSearchInput" placeholder="Dermokozmetik ürünlerinde ara..." data-i18n="searchPlaceholder">
        </div>
        <div id="searchResultsDropdown">
          <ul id="searchResultsList"></ul>
        </div>
      </div>
    </div>

    <div class="container" id="productDetailContainer"> 
      <div class="loading-container"> 
        <div class="loading-spinner"></div>
        <p class="loading-text" data-i18n="loadingText">Ürün bilgileri yükleniyor...</p>
      </div>
    </div>
  </main>

  <div id="imageLightbox" class="lightbox-modal">
    <span class="lightbox-close" title="Kapat (Esc)">×</span>
    <img class="lightbox-content" id="lightboxImg" alt="Büyük ürün görseli">
  </div>

  <div id="favoritesModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2 data-i18n="favoritesTitle">Favori Ürünlerim</h2>
      <div id="favoritesList" class="modal-list"></div>
      <p id="noFavoritesMessage" class="no-favorites-message" data-i18n="favoritesEmptyMessage">Henüz favori ürününüz bulunmamaktadır.</p>
    </div>
  </div>

  <div id="chatbotModal" class="modal chatbot-modal">
    <div class="modal-content chatbot-content">
      <span class="close-button">&times;</span>
      <h3>Serakıncı AI Asistanı</h3>
      <div class="chatbot-messages" id="chatbotMessages">
        <div class="bot-message" data-i18n="aiAssistantGreeting">Merhaba! Bu ürün hakkında merak ettiklerinizi bana sorabilirsiniz.</div>
      </div>
      <div class="chatbot-input-container">
        <input type="text" id="chatbotInput" placeholder="Sorunuzu yazın..." data-i18n="aiPlaceholder" aria-label="Yapay zeka asistanına sorunuzu yazın">
        <button id="chatbotSendBtn" class="chatbot-send-btn" aria-label="Mesaj Gönder" data-i18n="sendMessageLabel">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- İçindekiler Modalı (Artık kullanılmıyor, ancak yapısı burada kalabilir veya tamamen silinebilir) -->
  <!-- 
  <div id="ingredientsModal" class="modal">
    <div class="modal-content">
      // ... içerik ...
    </div>
  </div>
  -->


  <a id="favoritesNavLink" title="Favori ürünlerinizi görüntüleyin"><span data-i18n="favoritesLinkText">Favorilerim</span> <span id="favoritesCount" class="favorites-count">0</span></a>
  <button id="chatbotFloatingBtn" class="chatbot-floating-btn" title="Ürün hakkında yapay zekaya danış">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 9h8v2H8V9zm4 4H8v-2h4v2zm4 4H8v-2h8v2z"/></svg>
  </button>

  <button id="scrollToTopBtn" class="scroll-to-top" title="Başa Dön">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
  </button>
  <div id="copyTooltip" class="copy-tooltip" data-i18n="copiedTooltip">Kopyalandı!</div>
  <div id="favoriteTooltip" class="favorite-tooltip"></div>


  <footer>
    <div class="footer-left">
      <div class="footer-brand">
        <img src="/urunler/assets/logos/logo.png" alt="Serakıncı Limited Logo" />
        <h1>Serakıncı Limited</h1>
      </div>
      <div class="footer-slogan" data-i18n="footerSlogan">
        Hayvan Sağlığı, Cilt Güzelliği — Tek Adreste!
      </div>
    </div>
    <div class="footer-right">
      <a href="https://serakinci.com/" data-i18n="footerLinkAnaSayfa">Ana Sayfa</a>
      <a href="https://serakinci.com/bizkimiz" data-i18n="footerLinkHakkimizda">Hakkımızda</a>
      <a href="https://serakinci.com/services" data-i18n="footerLinkHizmetlerimiz">Hizmetlerimiz</a>
      <a href="https://serakinci.com/contact" data-i18n="footerLinkIletisim">İletişim</a>
      <a href="https://serakinci.com/careers" data-i18n="footerLinkKariyer">Kariyer</a>
      <a href="https://serakinci.com/faq" data-i18n="footerLinkSSS">Sıkça Sorulan Sorular</a>
      <button class="language-selector" aria-label="Dil Seçimi" data-i18n="langButtonText">Türkçe</button>
    </div>
  </footer>
  <div class="footer-bottom">
    <span data-i18n="footerCopyright">© <span id="currentYear"></span> Serakıncı Limited. Tüm hakları saklıdır.</span> | <span data-i18n="footerPoweredBy">Powered by</span>
    <a href="https://fures.tech" target="_blank">Fures Tech<img src="/urunler/assets/logos/fureslogo.png" alt="Fures Tech Logo"/></a>
  </div>

  <script src="/urunler/assets/js/translations.js"></script>
  <script src="/assets/i18n.js"></script>
  <script type="module">
    import { GoogleGenerativeAI } from "@google/genai";

    const GEMINI_API_KEY = "AIzaSyBEpqKAEZKYSyznxeZsQ1MYO-9hqV5LGoA";
    const FALLBACK_IMAGE_URL = '/urunler/assets/logos/resimyok.png';
    const API_BASE_PATH = '/urunler/api/';
    const LOCAL_IMAGE_BASE = `${API_BASE_PATH}gorseller/`;

    function localImageUrl(product) {
        if (!product || !product.ImageUrl || !product.ProductCode) return product?.ImageUrl || FALLBACK_IMAGE_URL;
        const match = product.ImageUrl.match(/\.([a-zA-Z0-9]+)(?:[?#].*)?$/);
        const ext = match ? match[1] : 'jpg';
        return `${LOCAL_IMAGE_BASE}${product.ProductCode}.${ext}`;
    }

    function applyLocalImages(list) {
        if (Array.isArray(list)) list.forEach(p => { p.ImageUrl = localImageUrl(p); });
    }

    function dedupeLimitImages(list, limit = 4){
        if(!Array.isArray(list)) return [];
        const seen = new Set();
        const result = [];
        for(const url of list){
            if(!url) continue;
            const base = String(url).split('?')[0];
            if(seen.has(base)) continue;
            seen.add(base);
            result.push(url);
            if(result.length >= limit) break;
        }
        return result;
    }
    const GEMINI_SDK_LOADED = typeof GoogleGenerativeAI !== 'undefined';
    
    const segment = 'dermokozmetik'; 
    let allProducts = []; 
    let allProductsForHeaderSearch = []; 
    let currentProduct = null; 
    
    let favorites = [];
    let searchDebounceTimer; 
    let headerSearchDebounceTimer;
    let G_isMouseOverDropdown = false;
    let G_isMouseOverHeaderDropdown = false;
    let currentEnhancedDetail = null;
    let currentExtraData = null;
    let biodermaDataCache = null;
    let etatPurDataCache = null;
    let esthedermDataCache = null;
    let caudalieDataCache = null;

    function t(key){
        const lang = document.documentElement.lang || 'tr';
        return window.translations?.[lang]?.[key] || key;
    }

    function getLocalized(obj, base){
        const lang = document.documentElement.lang || 'tr';
        if(!obj) return '';
        const val = obj[base];
        if(val && typeof val === 'object') return val[lang] || val.tr || Object.values(val)[0] || '';
        if(obj[`${base}_${lang}`]) return obj[`${base}_${lang}`];
        return obj[base] || '';
    }

    async function loadBiodermaData(){
        if(biodermaDataCache) return biodermaDataCache;
        const lang = document.documentElement.lang || 'tr';
        const fileMap = {
            'tr': 'products_bioderma.json',
            'en': 'products_bioderma_en.json',
            'ru': 'products_bioderma_ru.json'
        };
        const fileName = fileMap[lang] || 'products_bioderma.json';
        try {
            biodermaDataCache = await fetchJsonData(fileName);
        } catch(e){
            console.warn(`${fileName} yüklenemedi:`, e);
            if(fileName !== 'products_bioderma.json'){
                try{
                    biodermaDataCache = await fetchJsonData('products_bioderma.json');
                }catch(e2){
                    console.warn('products_bioderma.json yüklenemedi:', e2);
                    biodermaDataCache = [];
                }
            }else{
                biodermaDataCache = [];
            }
        }
        return biodermaDataCache;
    }

    function findBiodermaExtra(allData, product){
        if(!product || !allData) return null;
        const slug = slugify(product.ProductName);
        const pid = String(product.ProductId);
        const code = String(product.ProductCode);
        return allData.find(b => String(b.ProductId) === pid) ||
               allData.find(b => b.sku && String(b.sku) === code) ||
               allData.find(b => b.name && slugify(b.name) === slug) || null;
    }

    async function loadEtatPurData(){
        if(etatPurDataCache) return etatPurDataCache;
        const lang = document.documentElement.lang || 'tr';
        const fileMap = {
            'tr': 'products_etat-pur.json',
            'en': 'products_etat-pur_en.json',
            'ru': 'products_etat-pur_ru.json'
        };
        const fileName = fileMap[lang] || 'products_etat-pur.json';
        try {
            etatPurDataCache = await fetchJsonData(fileName);
        } catch(e){
            console.warn(`${fileName} yüklenemedi:`, e);
            if(fileName !== 'products_etat-pur.json'){
                try{
                    etatPurDataCache = await fetchJsonData('products_etat-pur.json');
                }catch(e2){
                    console.warn('products_etat-pur.json yüklenemedi:', e2);
                    etatPurDataCache = [];
                }
            }else{
                etatPurDataCache = [];
            }
        }
        return etatPurDataCache;
    }

    async function loadEsthedermData(){
        if(esthedermDataCache) return esthedermDataCache;
        const lang = document.documentElement.lang || 'tr';
        const fileMap = {
            'tr': 'products_institut-esthederm.json',
            'en': 'products_institut-esthederm_en.json',
            'ru': 'products_institut-esthederm_ru.json'
        };
        const fileName = fileMap[lang] || 'products_institut-esthederm.json';
        try {
            esthedermDataCache = await fetchJsonData(fileName);
        } catch(e){
            console.warn(`${fileName} yüklenemedi:`, e);
            if(fileName !== 'products_institut-esthederm.json'){
                try{
                    esthedermDataCache = await fetchJsonData('products_institut-esthederm.json');
                }catch(e2){
                    console.warn('products_institut-esthederm.json yüklenemedi:', e2);
                    esthedermDataCache = [];
                }
            }else{
                esthedermDataCache = [];
            }
        }
        return esthedermDataCache;
    }

    async function loadCaudalieData(){
        if(caudalieDataCache) return caudalieDataCache;
        const lang = document.documentElement.lang || 'tr';
        const fileMap = {
            'tr': 'products_caudalie.json',
            'en': 'products_caudalie_en.json',
            'ru': 'products_caudalie_ru.json'
        };
        const fileName = fileMap[lang] || 'products_caudalie.json';
        try{
            caudalieDataCache = await fetchJsonData(fileName);
        }catch(e){
            console.warn(`${fileName} yüklenemedi:`, e);
            if(fileName !== 'products_caudalie.json'){
                try{
                    caudalieDataCache = await fetchJsonData('products_caudalie.json');
                }catch(e2){
                    console.warn('products_caudalie.json yüklenemedi:', e2);
                    caudalieDataCache = [];
                }
            }else{
                caudalieDataCache = [];
            }
        }
        return caudalieDataCache;
    }

    function findBrandExtra(allData, product){
        if(!product || !allData) return null;
        const slug = slugify(product.ProductName);
        const pid = String(product.ProductId);
        const code = String(product.ProductCode);
        return allData.find(b => String(b.ProductId) === pid) ||
               allData.find(b => b.sku && String(b.sku) === code) ||
               allData.find(b => b.name && slugify(b.name) === slug) || null;
    }

    
    async function generateChatResponse(productName, category, question, chatHistory = []) {
        if (!GEMINI_SDK_LOADED) throw new Error("Yapay zeka modülü (SDK) yüklenemedi.");
        if (!GEMINI_API_KEY || GEMINI_API_KEY.includes("PLACEHOLDER")) {
             if (GEMINI_API_KEY === "AIzaSyBEpqKAEZKYSyznxeZsQ1MYO-9hqV5LGoA" && !GEMINI_API_KEY.includes("PLACEHOLDER")) {
                // Demo key
            } else {
                throw new Error("Gemini API anahtarı yapılandırılmamış.");
            }
        }
        const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash-preview-05-20" });
        const historyPrompt = chatHistory.map(msg => `**${msg.role === 'user' ? 'Kullanıcı' : 'Asistan'}**: ${msg.text}`).join('\n');
        const prompt = `
            Sen Serakıncı Limited için bir müşteri destek asistanısın. Sadece hayvan sağlığı ve dermokozmetik ürünleri hakkında bilgi veriyorsun. 
            Şu an "${productName}" (${category || 'Dermokozmetik'}) ürünü hakkında konuşuyoruz. 
            Kullanıcı sorusu: "${question}".
            Önceki konuşma:
            ${historyPrompt}
            Lütfen bu ürüne odaklanarak, kısa, anlaşılır ve Türkçe bir cevap ver. Bilmediğin veya emin olmadığın konularda 'Bu konuda detaylı bilgi için lütfen ürün uzmanımıza veya firmamıza danışın.' de. Asla tıbbi tavsiye verme veya tanı koyma.
        `;
        try {
            const result = await model.generateContent(prompt);
            const response = result.response;
            return response.text();
        } catch (error) {
            console.error("AI Chat Hatası (Dermokozmetik):", error);
            return "Üzgünüm, şu anda sorunuzu yanıtlayamıyorum. Lütfen daha sonra tekrar deneyin veya firmamızla iletişime geçin.";
        }
    }
    function setupScrollToContactButton() {
        const scrollToContactBtn = document.getElementById("scrollToContactBtn");
        if (scrollToContactBtn) {
            scrollToContactBtn.addEventListener("click", () => {
                const contactSection = document.querySelector(".contact-card-modern");
                if (contactSection) {
                    contactSection.scrollIntoView({ behavior: "smooth" });
                } else {
                    console.warn("İletişim bölümü bulunamadı.");
                }
            });
        }
    }




    function setupChatbotModal() {
        const modal = document.getElementById('chatbotModal');
        const btn = document.getElementById('chatbotFloatingBtn');
        const closeBtn = modal.querySelector('.close-button');
        const sendBtn = document.getElementById('chatbotSendBtn');
        const input = document.getElementById('chatbotInput');
        const messagesEl = document.getElementById('chatbotMessages');
        let chatHistory = [];

        function addMessage(text, role = 'bot') {
            const msgDiv = document.createElement('div');
            msgDiv.className = role === 'bot' ? 'bot-message' : 'user-message';
            msgDiv.textContent = text;
            messagesEl.appendChild(msgDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight; 
            chatHistory.push({ role, text });
        }
        
        async function sendChat() {
            const question = input.value.trim();
            if (!question || !currentProduct) {
                if(!currentProduct) addMessage("Ürün bilgileri henüz yüklenmedi, lütfen bekleyin.", 'bot');
                return;
            }
            
            addMessage(question, 'user');
            input.value = '';
            input.disabled = true;
            sendBtn.disabled = true;
            
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'bot-message typing';
            messagesEl.appendChild(typingIndicator);
            messagesEl.scrollTop = messagesEl.scrollHeight;

            try {
                const response = await generateChatResponse(currentProduct.ProductName, currentProduct.cat || 'Dermokozmetik', question, chatHistory);
                messagesEl.removeChild(typingIndicator);
                addMessage(response, 'bot');
            } catch (error) {
                messagesEl.removeChild(typingIndicator);
                addMessage("Üzgünüm, bir hata oluştu. Lütfen tekrar deneyin.", 'bot');
            } finally {
                input.disabled = false;
                sendBtn.disabled = false;
                input.focus();
            }
        }
        if (modal && btn && closeBtn && sendBtn && input && messagesEl) {
            btn.onclick = () => { 
                let isAiDisabled = false;
                if (!GEMINI_SDK_LOADED) isAiDisabled = true;
                if (!GEMINI_API_KEY || GEMINI_API_KEY.includes("PLACEHOLDER")) {
                     if (!(GEMINI_API_KEY === "AIzaSyBEpqKAEZKYSyznxeZsQ1MYO-9hqV5LGoA" && !GEMINI_API_KEY.includes("PLACEHOLDER"))) {
                        isAiDisabled = true;
                    }
                }
                if (isAiDisabled) {
                    alert("AI Chatbot şu an kullanılamıyor (API anahtarı eksik veya SDK yüklenmedi).");
                    return;
                }
                if (currentProduct) modal.classList.add('show'); 
                else alert("Ürün bilgileri henüz yüklenmedi, lütfen bekleyin.");
            };
            closeBtn.onclick = () => modal.classList.remove('show');
            modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('show'); };
            sendBtn.onclick = sendChat;
            input.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendChat(); });
        }
    }
    
    // --- Ortak Yardımcı Fonksiyonlar ---
    function showTooltip(anchorElement, message, tooltipId) {
        const tooltip = document.getElementById(tooltipId);
        if (!tooltip) return;
        tooltip.textContent = message;
        const rect = anchorElement.getBoundingClientRect();
        tooltip.style.left = `${rect.left + window.scrollX + (rect.width / 2) - (tooltip.offsetWidth / 2)}px`;
        tooltip.style.top = `${rect.top + window.scrollY - tooltip.offsetHeight - 8}px`;
        tooltip.classList.add('show'); 
        setTimeout(() => { tooltip.classList.remove('show'); }, 2000);
    }
    
    function getProductCategory(product) { 
        return product?.cat || 'Dermokozmetik';
    }

    function slugify(text) {
        if (text == null) return 'isimsiz-urun';
        let str = String(text);
        const trMap = { 'ç':'c','Ç':'C','ğ':'g','Ğ':'G','ı':'i','İ':'I','ö':'o','Ö':'O','ş':'s','Ş':'S','ü':'u','Ü':'U' };
        for (const key in trMap) str = str.replace(new RegExp(key, 'g'), trMap[key]);
        str = str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        str = str.replace(/\//g, '').replace(/[\.,]/g, '');
        str = str.toLowerCase();
        str = str.replace(/(\d+)\s+(sensibio)/g, '$1$2');
        const units = 'ml|gr|l|kg|mg|cm|m|lt';
        str = str.replace(new RegExp(`\\b(${units})\\s+(shower|gel)\\b`, 'gi'), '$1$2');
        str = str.replace(new RegExp(`(\\d+)\\s*(${units})\\b`, 'gi'), '$1-$2');
        str = str.replace(/\s+/g, '-').replace(/[^\w-]+/g, '-').replace(/--+/g, '-').replace(/^-+|-+$/g, '');
        return str || 'isimsiz-urun';
    }

    function getSlugFromUrl() { 
      const pathname = window.location.pathname;
      const parts = pathname.split('/');
      if (parts.length >= 5 && (parts[3] === 'product' || parts[3] === 'product-pages') && parts[4]) { return parts[4]; }
      return '';
    }
    
    async function fetchJsonData(fileName) {
        const cacheKey = `jsonCache_${fileName}`;
        const cached = localStorage.getItem(cacheKey);
        if(cached){
            try { return JSON.parse(cached); } catch(e){ localStorage.removeItem(cacheKey); }
        }
        try {
            const response = await fetch(`${API_BASE_PATH}${fileName}`);
            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error(`Dosya bulunamadı: ${API_BASE_PATH}${fileName}`);
                } else {
                    throw new Error(`Dosya yüklenirken ağ hatası: ${API_BASE_PATH}${fileName} (${response.status} ${response.statusText})`);
                }
            }
            const data = await response.json();
            try { localStorage.setItem(cacheKey, JSON.stringify(data)); } catch(e){}
            return data;
        } catch (error) {
            console.error(`fetchJsonData Hata (${fileName}):`, error);
            throw error;
        }
    }

    function buildAttributesHTML(attrs) {
        if (!Array.isArray(attrs) || attrs.length === 0) return '';
        let html = '<div class="table-responsive">';
        attrs.forEach(attr => {
            if(!attr || !attr.caption || !Array.isArray(attr.values)) return;
            const rows = attr.values
                .filter(v => v && v.trim() && v.trim() !== '.')
                .map(v => `<tr><th width="200"><h3>${v}</h3></th></tr>`)
                .join('');
            if(rows)
                html += `<table class="attribute_lists table table-striped"><caption>${attr.caption}</caption><tbody>${rows}</tbody></table>`;
        });
        html += '</div>';
        return html;
    }

    function showError(msg) {
      const detailContainer = document.getElementById('productDetailContainer');
      if (!detailContainer) { return; }
      const segName = segment === 'dermokozmetik' ? t('categoryDermokozmetikTitle') : t('categoryHayvanTitle');
      const backLinkText = t('backToListButton').replace('{segmentName}', segName);
      detailContainer.innerHTML = `<div class="error-container"><h2>${t('errorLoadingProduct')}</h2><p>${msg}</p><a href="/urunler/${segment}/" class="back-button-modern" style="margin-top:1rem;"><span class="back-icon">←</span> ${backLinkText}</a></div>`;
    }
    
    // --- Favoriler ---
    function loadFavorites() { 
        favorites = JSON.parse(localStorage.getItem('serakinciGlobalFavorites')) || []; 
        updateFavoritesCount(); 
    }
    function saveFavorites() { 
        localStorage.setItem('serakinciGlobalFavorites', JSON.stringify(favorites)); 
        updateFavoritesCount(); 
    }
    function isFavorite(productId, currentSegmentForCheck) { 
        return favorites.some(fav => fav.ProductId === productId && fav.Segment === currentSegmentForCheck); 
    }
    function updateFavoritesCount() { 
        const countEl = document.getElementById('favoritesCount');
        if(countEl) {
            countEl.textContent = favorites.length; 
            if (favorites.length > 0) {
                countEl.style.display = 'inline-flex'; 
            } else {
                countEl.style.display = 'none';
            }
        }
    }
    function toggleFavorite(product, btnElement) { 
        const productId = product.ProductId; 
        if (isFavorite(productId, segment)) { 
            favorites = favorites.filter(fav => !(fav.ProductId === productId && fav.Segment === segment));
            showTooltip(btnElement, 'Favorilerden çıkarıldı!', 'favoriteTooltip');
            btnElement.classList.remove('favorited');
        } else {
            favorites.push({
                ProductId: productId,
                ProductName: product.ProductName,
                ImageUrl: localImageUrl(product),
                Category: product.cat || 'Dermokozmetik',
                Segment: segment,
                Slug: slugify(product.ProductName)
            });
            showTooltip(btnElement, 'Favorilere eklendi!', 'favoriteTooltip');
            btnElement.classList.add('favorited');
        }
        saveFavorites();
    }
    function displayFavoritesModal() { 
        const listEl = document.getElementById('favoritesList');
        const noFavMsg = document.getElementById('noFavoritesMessage');
        if (!listEl || !noFavMsg) return;
        listEl.innerHTML = '';
        if (favorites.length === 0) {
            noFavMsg.style.display = 'block';
        } else {
            noFavMsg.style.display = 'none';
            favorites.forEach(fav => {
                const item = document.createElement('div');
                item.className = 'modal-list-item';
                item.innerHTML = `
                    <a href="/urunler/${fav.Segment}/product-pages/${fav.Slug}/" title="${fav.ProductName} Detayı">
                        <img src="${fav.ImageUrl}" alt="${fav.ProductName}" loading="lazy" onerror="this.src='${FALLBACK_IMAGE_URL}'">
                    </a>
                    <div class="modal-list-item-info">
                        <a href="/urunler/${fav.Segment}/product-pages/${fav.Slug}/" class="name" title="${fav.ProductName} Detayı">${fav.ProductName}</a>
                        <span class="category">${fav.Category} (${fav.Segment === 'dermokozmetik' ? 'Dermo' : 'Hayvan Sağ.'})</span>
                    </div>
                    <div class="modal-list-item-actions">
                        <button class="remove-fav-btn" data-product-id="${fav.ProductId}" data-segment="${fav.Segment}" title="Favorilerden Çıkar">
                            <svg viewBox="0 0 24 24" fill="#e74c3c" width="20" height="20"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </button>
                    </div>`;
                listEl.appendChild(item);
            });
            document.querySelectorAll('.remove-fav-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const idToRemove = e.currentTarget.dataset.productId;
                    const segmentToRemove = e.currentTarget.dataset.segment;
                    favorites = favorites.filter(f => !(f.ProductId == idToRemove && f.Segment == segmentToRemove) );
                    saveFavorites();
                    displayFavoritesModal(); 
                    if (currentProduct && currentProduct.ProductId == idToRemove && segment == segmentToRemove) {
                        const favBtnOnPage = document.getElementById('favoriteBtn');
                        if (favBtnOnPage) favBtnOnPage.classList.remove('favorited');
                    }
                };
            });
        }
    }
    function setupFavoritesModalInteractions() { 
        const modal = document.getElementById('favoritesModal');
        const link = document.getElementById('favoritesNavLink');
        const closeBtn = modal.querySelector('.close-button');
        
        if (link && modal && closeBtn) {
            link.onclick = (e) => { e.preventDefault(); displayFavoritesModal(); modal.classList.add('show'); };
            closeBtn.onclick = () => modal.classList.remove('show');
            modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('show'); };
        }
    }

    async function loadAllProductsForSearch() { 
        try {
            const productsResponse = await fetch(API_BASE_PATH + 'products.json'); 
            if (!productsResponse.ok) throw new Error(`Dermokozmetik ürünleri (arama için) yüklenemedi (${productsResponse.status})`);
            allProducts = await productsResponse.json();
            applyLocalImages(allProducts);
        } catch (error) {
            console.error('Arama için dermokozmetik ürünleri yüklenirken hata:', error);
            allProducts = [];
        }
    }
    
    function updateMetaTags(product, productDetailOrExtra) {
        const ogUrlMeta = document.querySelector('meta[property="og:url"]');
        if (ogUrlMeta) ogUrlMeta.content = window.location.href;

        const pageTitle = `${product.ProductName} | Dermokozmetik | Serakıncı`;
        document.title = pageTitle; 
        const ogTitleMeta = document.querySelector('meta[property="og:title"]');
        if (ogTitleMeta) ogTitleMeta.content = pageTitle;
        const twitterTitleMeta = document.querySelector('meta[name="twitter:title"]');
        if (twitterTitleMeta) twitterTitleMeta.content = pageTitle;

        const description = productDetailOrExtra?.description || product.ProductShortDescription || `Serakıncı'da ${product.ProductName} dermokozmetik ürününü inceleyin.`;
        const descMeta = document.querySelector('meta[name="description"]');
        if (descMeta) descMeta.content = description.substring(0,160);
        const ogDescMeta = document.querySelector('meta[property="og:description"]');
        if (ogDescMeta) ogDescMeta.content = description.substring(0,160);
        const twitterDescMeta = document.querySelector('meta[name="twitter:description"]');
        if (twitterDescMeta) twitterDescMeta.content = description.substring(0,160);

        let imageUrl = localImageUrl(product);
        if (productDetailOrExtra) {
            if (Array.isArray(productDetailOrExtra.imagesLocal) && productDetailOrExtra.imagesLocal.length > 0 && !/default\.jpg$/i.test(productDetailOrExtra.imagesLocal[0])) {
                imageUrl = '/' + productDetailOrExtra.imagesLocal[0].replace(/\\/g, '/');
            } else if (Array.isArray(productDetailOrExtra.imageUrls) && productDetailOrExtra.imageUrls.length > 0) {
                imageUrl = productDetailOrExtra.imageUrls[0];
            }
        }
        if (imageUrl) {
            try {
              const absoluteImageUrl = new URL(imageUrl, window.location.origin).href;
              const ogImageMeta = document.querySelector('meta[property="og:image"]');
              if (ogImageMeta) ogImageMeta.content = absoluteImageUrl;
              const twitterImageMeta = document.querySelector('meta[name="twitter:image"]');
              if (twitterImageMeta) twitterImageMeta.content = absoluteImageUrl;
            } catch (e) {
              console.warn("Geçersiz resim URL'si (meta):", imageUrl, e);
              const absoluteDefaultImageUrl = new URL(FALLBACK_IMAGE_URL, window.location.origin).href;
              const ogImageMeta = document.querySelector('meta[property="og:image"]');
              if (ogImageMeta) ogImageMeta.content = absoluteDefaultImageUrl;
              const twitterImageMeta = document.querySelector('meta[name="twitter:image"]');
              if (twitterImageMeta) twitterImageMeta.content = absoluteDefaultImageUrl;
            }
        }
        
        const schemaScript = document.querySelector('script[type="application/ld+json"]');
        if (schemaScript) {
            try {
                const schemaData = JSON.parse(schemaScript.textContent);
                schemaData.name = product.ProductName;
                schemaData.description = description;
                if (imageUrl) { try { schemaData.image = new URL(imageUrl, window.location.origin).href; } catch(e){ schemaData.image = new URL(FALLBACK_IMAGE_URL, window.location.origin).href; } }
                if (product.brand) schemaData.brand = { "@type": "Brand", "name": product.brand };
                schemaScript.textContent = JSON.stringify(schemaData, null, 2);
            } catch (e) {
                console.error("Schema.org JSON parse/update error:", e);
            }
        }
    }

    async function loadProductDetail(slugFromUrl) { 
      const productDetailContainer = document.getElementById('productDetailContainer');
      if (productDetailContainer) {
        productDetailContainer.innerHTML = `<div class="loading-container"><div class="loading-spinner"></div><p class="loading-text">Ürün bilgileri yükleniyor...</p></div>`;
      }

      try {
        if (allProducts.length === 0) { await loadAllProductsForSearch(); } 
        if (allProducts.length === 0) {
            showError('Ürün veritabanına erişilemiyor. Lütfen daha sonra tekrar deneyin.');
            return;
        }
        
        currentProduct = null; 
        for (const p of allProducts) {
            if (!p.ProductName) continue; 
            const productNameSlug = slugify(p.ProductName); 
            if (productNameSlug === slugFromUrl) {
                currentProduct = p;
                currentProduct.ImageUrl = localImageUrl(p);
                break;
            }
        }

        if (!currentProduct) {
            console.warn(`loadProductDetail (dermokozmetik): "${slugFromUrl}" slug'ı ile ürün products.json'da bulunamadı.`);
            showError('Aradığınız ürün bulunamadı veya bağlantı hatalı. Lütfen kontrol edin.');
            return;
        }
        
        let productDetail = null; 
        try {
            const detailsResponse = await fetchJsonData('detay-product.json');
            productDetail = detailsResponse.find(detail => detail.ProductId === currentProduct.ProductId);
        } catch (e) {
            console.warn("detay-product.json yüklenemedi veya işlenemedi:", e);
        }

        let extraData = null;
        if (currentProduct.brand) {
          const brand = currentProduct.brand.toLowerCase();
          try {
            if (brand === 'bioderma') {
              const resp = await loadBiodermaData();
              extraData = findBiodermaExtra(resp, currentProduct);
              if(!extraData) console.warn(`Bioderma ürünü (${currentProduct.ProductName}) için products_bioderma.json içinde eşleşen kayıt bulunamadı.`);
            } else if (brand === 'caudalie') {
              const resp = await loadCaudalieData();
              extraData = findBrandExtra(resp, currentProduct);
            } else if (brand === 'etat pur') {
              const resp = await loadEtatPurData();
              extraData = findBrandExtra(resp, currentProduct);
            } else if (brand === 'esthederm' || brand === 'institut esthederm') {
              const resp = await loadEsthedermData();
              extraData = findBrandExtra(resp, currentProduct);
            }
          } catch (e) {
            console.warn(`${currentProduct.brand} ek bilgileri yüklenemedi:`, e);
          }
        }

        currentEnhancedDetail = extraData || productDetail;
        currentExtraData = extraData;
        displayProductDetail(currentProduct, productDetail, extraData);
        updateMetaTags(currentProduct, extraData || productDetail); // Ek açıklama varsa öncelikli

      } catch (error) {
        console.error('loadProductDetail (dermokozmetik): Ürün yüklenirken genel hata:', error);
        showError(`Ürün yüklenirken bir hata oluştu. Lütfen daha sonra tekrar deneyin.`);
      }
    }

    // displayProductDetail fonksiyonu, bir önceki yanıttaki gibi kalacak,
    // sadece `extraData` parametresini alacak ve tab oluşturma mantığı güncellenecek.
    // Bu fonksiyon çok uzun olduğu için burada tekrar etmiyorum, bir önceki yanıttan alınabilir.
    // Anahtar değişiklikler: `extraData.description` kullanımı,
    // `extraData.series` gösterimi, `extraData.tabs` ile ek sekmeler,
    // ve `extraData.imagesLocal` ile galeri oluşturma.
    // **Aşağıda sadece güncellenmiş displayProductDetail fonksiyonunu veriyorum:**
    function displayProductDetail(product, productDetail, extraData = null) { 
      const detailContainer = document.getElementById('productDetailContainer');
      if (!detailContainer) return; 
      
      currentProduct = product; 

      let galleryImages = [];
      if (extraData) {
          if (Array.isArray(extraData.imagesLocal) && extraData.imagesLocal.some(p => p && !/default\.jpg$/i.test(p))) {
              galleryImages = extraData.imagesLocal.filter(p => p && !/default\.jpg$/i.test(p)).map(p => '/' + p.replace(/\\/g, '/'));
          }
          if (galleryImages.length === 0 && Array.isArray(extraData.imageUrls) && extraData.imageUrls.length > 0) {
              galleryImages = extraData.imageUrls.slice();
          }
      }
      galleryImages = dedupeLimitImages(galleryImages);
      if (galleryImages.length === 0) {
          galleryImages = [localImageUrl(product)];
      }
      let mainImageUrl = galleryImages[0];

      const imageHTML = `
        <div class="product-main-image-wrapper" id="mainProductImageWrapper">
            <img src="${mainImageUrl}" alt="${product.ProductName}" class="product-main-image-modern" id="mainProductImageElement" onerror="this.onerror=null; this.src='${FALLBACK_IMAGE_URL}';">
        </div>
        ${galleryImages.length > 1 ? `
        <div class="product-thumbnails">
            ${galleryImages.map((imgSrc, index) => `<img src="${imgSrc}" alt="${product.ProductName} - Ek Görsel ${index + 1}" onclick="window.updateMainImage('${imgSrc}', this)" class="${index === 0 ? 'active-thumbnail' : ''}" onerror="this.style.display='none';">`).join('')}
        </div>` : ''}
      `;
      
      const favProductId = product.ProductId;
      const isFav = isFavorite(favProductId, segment);
      const favoriteButtonHTML = `
        <button class="favorite-button ${isFav ? 'favorited' : ''}" id="favoriteBtn" title="Favorilere Ekle/Çıkar">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>`;

      let metaInfoHTML = '<div class="product-meta-enhanced">';
      if (product.brand) metaInfoHTML += `<span class="meta-item"><strong>${t('labelManufacturer')}:</strong> ${product.brand}</span>`;
      if (extraData && extraData.series) {
        metaInfoHTML += `<span class="meta-item"><strong>${t('labelSeries')}:</strong> ${extraData.series}</span>`;
      }
      if (product.cat) metaInfoHTML += `<span class="meta-item"><strong>${t('labelCategory')}:</strong> ${product.cat}</span>`;
      const productCodeToDisplay = productDetail?.DisplayProductCode || product.ProductCode;
      if (productCodeToDisplay) metaInfoHTML += `<span class="meta-item"><strong>${t('labelProductCode')}:</strong> <span id="productCodeValue">${productCodeToDisplay}</span> <span class="copy-code" title="${t('copyButtonTitle')}" onclick="window.copyProductCode(event)">${t('copyButton')}</span></span>`;
      metaInfoHTML += '</div>';
      if (metaInfoHTML === '<div class="product-meta-enhanced"></div>') metaInfoHTML = '';

      const productUrl = window.location.href;
      const shareText = encodeURIComponent(`Serakıncı'da ${product.ProductName} ürününü inceleyin:`);
      let shareButtonsHTML = `
        <div class="product-share-buttons">
          <span class="share-label">${t('labelShare')}</span>
          <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(productUrl)}" target="_blank" rel="noopener" title="Facebook'ta Paylaş">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#1877F2"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
          </a>
          <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(productUrl)}&text=${shareText}" target="_blank" rel="noopener" title="Twitter'da Paylaş"><svg viewBox="0 0 24 24"><path fill="#1DA1F2" d="M22.46 6c-.77.35-1.6.58-2.46.67.9-.53 1.59-1.37 1.92-2.38-.84.5-1.78.86-2.79 1.07C18.28 4.47 17.03 4 15.64 4c-2.97 0-5.32 2.44-5.32 5.45 0 .42.05.84.14 1.24C7.08 10.5 4.07 8.76 2.05 6.12c-.44.75-.69 1.62-.69 2.55 0 1.88 1 3.55 2.4 4.52-.88-.03-1.7-.27-2.42-.66v.07c0 2.63 1.85 4.82 4.3 5.32-.45.12-.93.18-1.42.18-.34 0-.68-.03-1-.1C4.56 19.95 6.43 21.3 8.63 21.3c-1.84 1.44-4.17 2.3-6.7 2.3-.43 0-.86-.02-1.28-.08C3.38 22.89 5.92 24 8.78 24c7.22 0 11.6-6.12 11.12-12.07.79-.57 1.47-1.29 2-2.06z"/></svg></a>
          <a href="https://api.whatsapp.com/send?text=${shareText} ${encodeURIComponent(productUrl)}" target="_blank" rel="noopener" title="WhatsApp'ta Paylaş"><svg viewBox="0 0 24 24"><path fill="#25D366" d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.38 1.25 4.8L2 22l5.29-1.38c1.37.71 2.93 1.12 4.56 1.12h.1c5.46 0 9.91-4.45 9.91-9.91S17.68 2 12.04 2zm4.64 12.13c-.14-.07-.86-.42-1-.49-.14-.07-.24-.11-.34.11-.1.22-.38.49-.47.59-.09.1-.18.11-.34.04-.16-.07-.68-.25-1.29-.79-.48-.42-.79-.94-.88-1.1s-.09-.25 0-.38c.08-.11.18-.28.28-.42.09-.14.14-.25.2-.42.07-.18.04-.33-.02-.44s-.34-.81-.47-1.1c-.12-.29-.25-.25-.34-.25-.09 0-.18 0-.28.02s-.24.11-.38.38c-.14.28-.54.86-.54 1.5s.54 1.74.62 1.86c.08.11.97 1.48 2.42 2.03.34.14.61.21.82.28.29.09.54.08.74.02.22-.07.68-.28.78-.55.1-.28.1-.51.07-.59s-.14-.11-.3-.18z"/></svg></a>
        </div>`;
// ► Ürün adı (i18n + fallback)
const namePart = getLocalized(extraData, 'name') || product.ProductName;

// ► Ürün kısa açıklaması (i18n + fallback)
const descPart = getLocalized(extraData, 'description') ||
                 product.ProductShortDescription ||
                 t('shortDescFallback').replace('{product}', product.ProductName);

// ► “description0” sekmesindeki özel HTML
let desc0Html = '';
if (extraData?.tabs?.length) {
  const d0 = extraData.tabs.find(t => String(t.id).toLowerCase() === 'description0');
  if (d0?.html) desc0Html = d0.html;
}

// ► Üst kısımdaki kısa açıklama kutusu
let shortDescriptionHTML = `
  <div class="product-short-description">
    <p>${namePart}</p>
    <p>${descPart}</p>
    ${desc0Html}
  </div>`;

// ► “Daha fazla bilgi” butonu
const actionButtonHTML = `
  <div id="ai-button-container">
    <button id="scrollToContactBtn" title="Daha fazla bilgi için iletişim bölümüne gidin">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 16.5l-6-6 1.41-1.41L12 13.67l4.59-4.58L18 10.5z"/>
      </svg>
      ${t('moreInfoButton')}
    </button>
  </div>`;

// ► Sekme navigasyonu & içerik
let tabNavigationHTML = '';
let tabContentHTML    = '';

const detayIcerik = getLocalized(productDetail, 'Ürün Açıklaması') || namePart;

if (detayIcerik?.trim()) {
  tabNavigationHTML += `
    <button class="tab-link-modern active" data-tab="tabDetaylar">
      ${t('tabDetaylar')}
    </button>`;

  tabContentHTML += `
    <div id="tabDetaylar" class="tab-pane-modern active">
      <h3>${t('tabDetaylar')}</h3>
      <div>${detayIcerik}</div>
      ${extraData?.url
        ? `<p style="margin-top:1rem;">
             <strong>${t('moreInfoLabel')}</strong>
             <a href="${extraData.url}" target="_blank" rel="noopener noreferrer" class="underline">
               ${extraData.url}
             </a>
           </p>`
        : ''}
    </div>`;
}

// Hepsi hazır – derlenebilir ve çatışmasız (konfliktfrei)! 😉

      // Marka verilerinden gelen ek tabları ve içerikleri ekle
      if (extraData) {
          if (extraData.ingredientsList && extraData.ingredientsList.length > 0) {
              // Bileşenler sekmesi içinde direkt gösterilecek, ayrı bir İçindekiler sekmesi yok.
              // Bu bölümü "Bileşenler" veya "Detaylı İçerik Bilgisi" sekmesine ekleyebiliriz.
              // Şimdilik "Detaylı İçerik Bilgisi" sekmesi yok, bu yüzden yeni bir tane oluşturalım veya mevcut birine ekleyelim.
              // "Bileşenler" isimli bir tab JSON'dan geliyorsa ona ekleyebiliriz.
              // Bu örnekte, "Ürün Detayları" tabının sonuna ekleyelim
              const ingredientsHTML = `
                <div class="ingredients-section">
                    <h3>İçindekiler</h3>
                    <ul class="ingredients-list">
                        ${extraData.ingredientsList.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                    ${extraData.tabs?.find(t => t.id === 'composition')?.html?.includes('ask.NAOS.com.tr') ? 
                        `<div class="ask-naos-link">
                            <a href="${extraData.tabs.find(t => t.id === 'composition').html.match(/href="(https:\/\/ask-naos\.com\.tr\/product\/[^"]+)"/)[1]}" target="_blank" class="underline">ask.NAOS.com.tr'de Tüm İçerik ve Detaylarını Keşfet</a>
                         </div>` : ''}
                    <p class="ingredients-disclaimer">Burada listelenen maddeler, bu ürün için tasarlanan en güncel formülde kullanılan maddelerdir. Üretimi ile dağıtımı arasında bir gecikme olabileceği için lütfen paket üstündeki içindekiler listesini dikkate alın.</p>
                </div>`;
              // tabContentHTML içindeki #tabDetaylar'ın sonuna ekleyelim
              const tempDiv = document.createElement('div');
              tempDiv.innerHTML = tabContentHTML;
              const tabDetaylarDiv = tempDiv.querySelector('#tabDetaylar');
              if (tabDetaylarDiv) {
                  tabDetaylarDiv.innerHTML += ingredientsHTML;
                  tabContentHTML = tempDiv.innerHTML;
              }
          }

          if (extraData.tabs && extraData.tabs.length > 0) {
            extraData.tabs.forEach((bTab, index) => {
                const idLower = String(bTab.id || '').toLowerCase();
                const titleLower = String(bTab.title || '').toLowerCase();
                if (idLower.includes('review') || idLower.includes('yorum') ||
                    titleLower.includes('review') || titleLower.includes('yorum')) {
                    return; // Yorum/Review sekmelerini gösterme
                }
                if (idLower.includes('useage') || titleLower === 'ürün özellikleri') {
                    return; // markadan gelen ekstra "Ürün Özellikleri" tabını atla
                }
                // Eğer "composition" id'li tab ise ve içindekiler zaten eklendiyse, bu tabı farklı işleyebiliriz veya atlayabiliriz.
                // Bu örnekte, tüm tabları ekliyoruz. "Bileşenler" tabı için görseli kaldıracağız.
                let tabHtmlContent = bTab.html || "<p>İçerik bulunamadı.</p>";
                if (bTab.id === 'composition' || bTab.id === 'efficiency') {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(tabHtmlContent, 'text/html');
                    if (bTab.id === 'composition') {
                        doc.querySelectorAll('img, picture, figure').forEach(el => el.remove());
                    } else {
                        doc.querySelectorAll('figure img[src*="fjbmprhxnv.jpg"], figure img[src*="PROOF_generic_sensibio.jpg"]').forEach(img => {
                            const figure = img.closest('figure');
                            if (figure) figure.remove();
                        });
                    }
                    doc.querySelectorAll('a.btn[data-target="#ingredient-modal"]').forEach(btn => btn.remove());
                    doc.querySelectorAll('.modal#ingredient-modal').forEach(modal => modal.remove());
                    doc.querySelectorAll('a[data-toggle="modal"][data-target*="-source-modal"]').forEach(link => {
                        link.classList.add('read-more-btn');
                        link.style.textDecoration = 'none';
                    });
                    tabHtmlContent = doc.body.innerHTML;
                }


                const tabId = `extraTab_${bTab.id || index + 1}`;
                tabNavigationHTML += `<button class="tab-link-modern" data-tab="${tabId}">${bTab.title || `Ek Detay ${index + 1}`}</button>`;
                tabContentHTML += `<div id="${tabId}" class="tab-pane-modern">${tabHtmlContent}</div>`;
            });
          }
          if (Array.isArray(extraData.attributes) && extraData.attributes.length > 0) {
            const attrTabId = 'tabAttributes';
tabNavigationHTML += `<button class="tab-link-modern" data-tab="${attrTabId}">${t('tabAttributes')}</button>`;

            tabContentHTML += `<div id="${attrTabId}" class="tab-pane-modern">${buildAttributesHTML(extraData.attributes)}</div>`;
          }
      }


      const relatedProductsTitle = product.cat ? t('otherProductsInCategory').replace('{category}', product.cat) : t('relatedProductsTitle');
      const relatedProducts = allProducts.filter(p => p.ProductName && p.cat === product.cat && slugify(p.ProductName) !== slugify(product.ProductName)).slice(0, 10);
      let relatedProductsHTML = '';
      if (relatedProducts.length > 0) {
        relatedProductsHTML = `<div class="related-products-section-modern"><h2 class="related-products-title-modern">${relatedProductsTitle}</h2><div class="related-products-carousel"><div class="carousel-arrow prev" onclick="window.scrollCarousel(-1, 'relatedProductsContainer')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></div><div class="related-products-container" id="relatedProductsContainer">`;
        relatedProducts.forEach(rp => {
          let rpImageUrl = localImageUrl(rp);
          relatedProductsHTML += `<a href="/urunler/${segment}/product-pages/${slugify(rp.ProductName)}/" class="related-product-card"><img src="${rpImageUrl}" alt="${rp.ProductName}" onerror="this.onerror=null; this.src='${FALLBACK_IMAGE_URL}';"><div class="info"><div class="name">${rp.ProductName}</div><div class="category">${rp.cat || 'Belirtilmemiş'}</div></div></a>`;
        });
        relatedProductsHTML += `</div><div class="carousel-arrow next" onclick="window.scrollCarousel(1, 'relatedProductsContainer')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></div></div></div>`;
      } else {
        relatedProductsHTML = `<div class="related-products-section-modern"><h2 class="related-products-title-modern">${relatedProductsTitle}</h2><p style="text-align:center; color:var(--text-medium); padding:1rem 0;">Bu kategoriye ait başka ürün bulunmamaktadır.</p></div>`;
      }

      const disclaimerHTML = `
      <div class="disclaimer-box-modern">
        <span>${t('disclaimerDermo')}</span>
      </div>`;
      
      const contactHTML = `
      <div class="contact-card-modern" id="contactSection">
        <div class="contact-title-modern">${t('contactUsTitle')}</div>
        <div class="contact-bar-modern"></div>
        <p class="contact-intro-text">${t('contactUsIntro')}</p>
        <div class="contact-grid">
          <div class="contact-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" /></svg><div><span class="contact-label-modern">${t('labelTelefon')}</span><a href="tel:+903923662594" class="contact-link-modern">+90 392 366 25 94</a></div></div>
          <div class="contact-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg><div><span class="contact-label-modern">${t('labelEposta')}</span><a href="mailto:info@serakinci.com" class="contact-link-modern">info@serakinci.com</a></div></div>
          <div class="contact-item"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg><div><span class="contact-label-modern">${t('labelAdres')}</span><span class="contact-address-text">Sht. Ziya Sok. No:1-2 99450<br>Gazimağusa - KKTC, Mersin 10 Turkey</span></div></div>
          <div class="contact-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.45 17.36c-.32-.1-.66-.16-1-.16-1.02 0-2.04.21-2.97.64-.34.16-.73.08-1-.16l-3.28-3.28c.43-.93.64-1.95.64-2.97 0-.34-.06-.68-.16-1l3.28-3.28c.24-.23.32-.62.16-1-.43-.93-.64-1.95-.64-2.97 0-.34.06-.68.16-1 .09-.28.03-.59-.18-.8l-1.09-1.09c-.21-.21-.52-.27-.8-.18-1 .1-1.98.38-2.87.82-.09.04-.18.07-.26.12L5.12 7.25c-.04.09-.07.17-.12.26C4.18 8.4 3.9 9.38 3.81 10.38c-.09.28-.03.59.18.8l1.09 1.09c.21.21.52.27.8.18 1-.1 1.98-.38 2.87-.82.09-.04.18.07.26-.12l5.75-5.75c.04-.09.07-.17.12-.26.89-.44 1.87-.72 2.87-.82.28-.09.59-.03.8.18l1.09 1.09c.21.21.27.52.18.8-.1 1-.38 1.98-.82 2.87-.04-.09-.07.18-.12.26L10.38 17c-.09.04-.17.07-.26.12-.89-.44-1.87.72-2.87.82-.28-.09-.59-.03-.8-.18l-1.09-1.09c-.21-.21-.27-.52-.18-.8.1-1 .38-1.98.82 2.87.04-.09.07.18.12-.26l.01-.01c.01 0 .01 0 0 0L17 5.12c.09-.04.17-.07.26-.12.9-.43 1.88-.64 2.9-.64.34 0 .68.06 1 .16.28.09.5.29.62.56.15.34.17.73.05 1.07-.27.78-.63 1.52-1.06 2.2-.01.01-.01.02-.02.03l-5.52 5.52c-.01.01-.02.01-.03.02-.68.43-1.42.79-2.2 1.06-.34.12-.62.34-.75.62s-.16.61-.05 1.07c.27.78.63 1.52 1.06 2.2.01.01.01.02.02.03l.01.01c.01 0 .01 0 0 0zM6.5 10.5c0 .28.22.5.5.5s.5-.22.5-.5-.22-.5-.5-.5-.5.22-.5.5z"/></svg><div><span class="contact-label-modern">${t('labelFax')}</span><a href="fax:+903923661585" class="contact-link-modern">+90 392 366 15 85</a></div></div>
        </div>
        <div class="firm-social-media">
            <span class="social-label">${t('socialMediaLabel')}</span>
            <div class="firm-social-media-row">
                <a href="https://www.facebook.com/cyprusdermocosmetic/" target="_blank" rel="noopener" title="Dermokozmetik Facebook">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#1877F2"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
                </a>
                <a href="https://www.instagram.com/serakincidermokozmetik/" target="_blank" rel="noopener" title="Dermokozmetik Instagram">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="none" fill="none" stroke-linecap="round" stroke-linejoin="round">
                       <defs>
                           <radialGradient id="instaGradientDermoPage" cx="30%" cy="107%" r="150%" fx="30%" fy="107%">
                                <stop offset="0%" stop-color="#fdf497"/>
                                <stop offset="5%" stop-color="#fdf497"/>
                                <stop offset="45%" stop-color="#fd5949"/>
                                <stop offset="60%" stop-color="#d6249f"/>
                                <stop offset="90%" stop-color="#285AEB"/>
                            </radialGradient>
                        </defs>
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <rect fill="url(#instaGradientDermoPage)" width="20" height="20" x="2" y="2" rx="5" ry="5"/>
                        <path stroke="#fff" stroke-width="1.8" d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37zm1.5-4.88h.01"/>
                    </svg>
                </a>
            </div>
        </div>
      </div>`;

      detailContainer.innerHTML = `
        <nav class="breadcrumbs">
          <a href="https://www.serakinci.com" class="breadcrumb-link">Ana Sayfa</a><span class="breadcrumb-separator">></span>
          <a href="/urunler/" class="breadcrumb-link">Ürün Kataloğu</a><span class="breadcrumb-separator">></span>
          <a href="/urunler/${segment}/" class="breadcrumb-link">${segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' ')}</a>
          ${product.cat ? `<span class="breadcrumb-separator">></span> <a href="/urunler/${segment}/?kategori=${slugify(product.cat)}" class="breadcrumb-link">${product.cat}</a>` : ''}
          <span class="breadcrumb-separator">></span><span class="breadcrumb-current">${product.ProductName}</span>
        </nav>
        <div class="product-main-layout">
          <div class="product-gallery-modern">${imageHTML}</div>
          <div class="product-info-modern">
            <div class="product-title-wrapper"><h1 class="product-title-modern">${product.ProductName}</h1>${favoriteButtonHTML}</div>
            ${metaInfoHTML}
            ${shareButtonsHTML}
            ${shortDescriptionHTML}
            ${actionButtonHTML} 
          </div>
        </div>
        ${tabNavigationHTML ? `<div class="product-details-tabs-modern"><div class="tabs-navigation-modern">${tabNavigationHTML}</div><div class="tab-content-modern">${tabContentHTML}</div></div>` : ''}
        ${relatedProductsHTML}
        ${disclaimerHTML}
        ${contactHTML}
        <a href="/urunler/${segment}/" class="back-button-modern"><span class="back-icon">←</span> ${t('backToListButton').replace('{segmentName}', segment === 'dermokozmetik' ? t('categoryDermokozmetikTitle') : t('categoryHayvanTitle'))}</a>
      `;

      const tabLinks = detailContainer.querySelectorAll('.tab-link-modern');
      const tabPanes = detailContainer.querySelectorAll('.tab-pane-modern');
      tabLinks.forEach(link => {
        link.addEventListener('click', () => {
          const targetTab = link.getAttribute('data-tab');
          tabLinks.forEach(tl => tl.classList.remove('active'));
          link.classList.add('active');
          tabPanes.forEach(pane => pane.id === targetTab ? pane.classList.add('active') : pane.classList.remove('active'));
        });
      });

      const mainImageWrapper = document.getElementById('mainProductImageWrapper');
      const mainImageElement = document.getElementById('mainProductImageElement'); // ID ile alıyoruz
      if (mainImageWrapper && mainImageElement && mainImageElement.src && !mainImageElement.src.endsWith(FALLBACK_IMAGE_URL.split('/').pop())) { 
        mainImageWrapper.onclick = function() {
          document.getElementById('lightboxImg').src = mainImageElement.src;
          document.getElementById('imageLightbox').classList.add('show');
          document.body.style.overflow = 'hidden';
        }
      }
      
      const favBtn = document.getElementById('favoriteBtn');
      if (favBtn) { favBtn.onclick = (event) => toggleFavorite(product, event.currentTarget); }

      setupScrollToContactButton(); // Setup for the new button
      
      
      // Ek tablardaki accordion ve modal'lar için temel event listener'lar (Bootstrap olmadan)
      detailContainer.querySelectorAll('.product-details-tabs-modern .card button[data-toggle="collapse"]').forEach(button => {
          button.addEventListener('click', function() {
              const targetId = this.dataset.target; // #collapseEfficiency1 gibi
              const targetElement = document.querySelector(targetId); // ID ile seç
              if (targetElement) {
                  const isExpanded = this.getAttribute('aria-expanded') === 'true';
                  this.setAttribute('aria-expanded', String(!isExpanded));
                  // 'show' class'ı Bootstrap'in collapse işlevselliği için, basit bir max-height ile simüle edilebilir
                  if (targetElement.classList.contains('show')) {
                      targetElement.classList.remove('show');
                      targetElement.style.maxHeight = null;
                  } else {
                      targetElement.classList.add('show');
                      targetElement.style.maxHeight = targetElement.scrollHeight + "px";
                  }
              }
          });
      });
      detailContainer.querySelectorAll('.product-details-tabs-modern [data-toggle="modal"]').forEach(button => {
          button.addEventListener('click', function(event) {
              event.preventDefault(); 
              const targetId = this.dataset.target; // #instant-source-modal gibi
              const targetModal = document.querySelector(targetId); // ID ile seç
              if (targetModal) {
                  targetModal.classList.add('show'); // display: flex yapacak
                  document.body.style.overflow = 'hidden';
                  const closeButton = targetModal.querySelector('.close');
                  if(closeButton) {
                      closeButton.onclick = () => { 
                          targetModal.classList.remove('show'); 
                          document.body.style.overflow = ''; 
                      };
                  }
                  targetModal.onclick = (e) => { 
                      if (e.target === targetModal) { // Sadece modalın dışına tıklanırsa kapat
                          targetModal.classList.remove('show'); 
                          document.body.style.overflow = '';
                      } 
                  };
              }
          });
      });

    }
    
    function setupLightbox() {
        const lightbox = document.getElementById('imageLightbox');
        const lightboxClose = lightbox.querySelector('.lightbox-close');
        if (!lightbox || !lightboxClose) return;
        const closeAction = () => { lightbox.classList.remove('show'); document.body.style.overflow = ''; };
        lightboxClose.onclick = closeAction;
        lightbox.onclick = (event) => { if (event.target === lightbox) closeAction(); }
        document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && lightbox.classList.contains('show')) { closeAction(); } });
    }

    function setupScrollToTopButton() {
        const btn = document.getElementById('scrollToTopBtn');
        if(!btn) return;
        window.onscroll = () => { btn.classList.toggle('show', (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100)); };
        btn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
    }
    
    window.copyProductCode = function(event) { 
        const productCodeEl = document.getElementById('productCodeValue');
        if (!productCodeEl) return;
        const productCode = productCodeEl.innerText;
        navigator.clipboard.writeText(productCode).then(() => {
            showTooltip(event.target, t('codeCopied'), 'copyTooltip');
        }).catch(err => {
            console.error('Kod kopyalanamadı: ', err);
            showTooltip(event.target, t('codeNotCopied'), 'copyTooltip');
        });
    }

    window.scrollCarousel = function(direction, containerId = 'relatedProductsContainer') { 
        const container = document.getElementById(containerId);
        if (container) {
            const scrollAmount = container.clientWidth * 0.8;
            container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
        }
    }

    window.toggleReadMore = function(elementId, button) { 
        const contentElement = document.getElementById(elementId);
        if (contentElement) {
            contentElement.classList.toggle('expanded');
            button.textContent = contentElement.classList.contains('expanded') ? 'Daha Az Göster' : 'Devamını Oku';
        }
    }
    
    window.updateMainImage = function(newSrc, thumbnailElement) {
        const mainImage = document.getElementById('mainProductImageElement'); 
        if (mainImage) mainImage.src = newSrc;
        
        document.querySelectorAll('.product-thumbnails img').forEach(img => img.classList.remove('active-thumbnail'));
        if(thumbnailElement) thumbnailElement.classList.add('active-thumbnail');
    }


    async function setupProductSearch() { 
        const pageSearchInput = document.getElementById('productSearchInput');
        const pageResultsDropdown = document.getElementById('searchResultsDropdown');
        const pageResultsList = document.getElementById('searchResultsList');

        if (pageSearchInput && pageResultsDropdown && pageResultsList) {
            if (allProducts.length === 0 && !getSlugFromUrl()) { 
                await loadAllProductsForSearch(); 
            }

            pageSearchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLocaleLowerCase('tr-TR');
                clearTimeout(searchDebounceTimer);
                if (searchTerm.length < 2) { pageResultsDropdown.style.display = 'none'; pageResultsList.innerHTML = ''; return; }

                searchDebounceTimer = setTimeout(async () => {
                    if(allProducts.length === 0) { 
                        await loadAllProductsForSearch(); 
                        if (allProducts.length === 0) { pageResultsList.innerHTML = '<li class="no-results">Ürünler yüklenemedi.</li>'; pageResultsDropdown.style.display = 'block'; return; }
                    }
                    const filtered = allProducts.filter(product => product.ProductName && product.ProductName.toLocaleLowerCase('tr-TR').includes(searchTerm));
                    pageResultsList.innerHTML = ''; 
                    if (filtered.length > 0) {
                        filtered.slice(0, 7).forEach(product => { 
                            const listItem = document.createElement('li');
                            let rpImageUrl = localImageUrl(product);
                            listItem.innerHTML = `
                                <a href="/urunler/${segment}/product-pages/${slugify(product.ProductName)}/">
                                    <img src="${rpImageUrl}" alt="${product.ProductName}" class="suggestion-image" onerror="this.onerror=null; this.src='${FALLBACK_IMAGE_URL}';">
                                    <span class="suggestion-name">${product.ProductName}</span>
                                    ${product.cat ? `<span class="suggestion-category">${product.cat}</span>` : ''}
                                </a>`;
                            pageResultsList.appendChild(listItem);
                        });
                    } else { pageResultsList.innerHTML = '<li class="no-results">"' + searchTerm + '" için sonuç bulunamadı.</li>'; }
                    pageResultsDropdown.style.display = 'block';
                }, 300); 
            });

            pageSearchInput.addEventListener('focus', function() {
                if (pageSearchInput.value.length >= 2 && pageResultsList.children.length > 0 && 
                    !(pageResultsList.firstChild.classList && pageResultsList.firstChild.classList.contains('no-results')) &&
                    !pageResultsList.firstChild.textContent.includes("yükleniyor")) {
                     pageResultsDropdown.style.display = 'block';
                }
            });
        }
        
        const headerSearchInput = document.getElementById('headerProductSearchInput');
        const headerSearchWrapper = document.querySelector('.header-search-wrapper');
        const headerResultsDropdown = document.getElementById('headerSearchResultsDropdown');
        const headerResultsList = document.getElementById('headerSearchResultsList');
        
        if (!headerSearchInput || !headerSearchWrapper || !headerResultsDropdown || !headerResultsList) {
            console.warn("Header arama elementleri bulunamadı, bu özellik çalışmayabilir.");
        } else {
             if (allProductsForHeaderSearch.length === 0) { 
                try { 
                    const [dermoProducts, animalProducts] = await Promise.all([
                        fetchJsonData('products.json').catch(e => { console.error("Dermo products for header search failed:", e); return []; }), 
                        fetchJsonData('hayvan-sagligi.json').catch(e => { console.error("Animal products for header search failed:", e); return []; }) 
                    ]);
                    allProductsForHeaderSearch = [
                        ...dermoProducts.map(p => ({...p, segment: 'dermokozmetik', slugFn: slugify})),
                        ...animalProducts.map(p => ({...p, segment: 'hayvan-sagligi', slugFn: (text) => {
                                if (text === null || typeof text === 'undefined') return 'isimsiz-urun';
                                const trMapHS = { 'ç': 'c', 'Ç': 'c', 'ğ': 'g', 'Ğ': 'g', 'ı': 'i', 'İ': 'i', 'ö': 'o', 'Ö': 'o', 'ş': 's', 'Ş': 's', 'ü': 'u', 'Ü': 'u' };
                                return String(text).replace(/[\u00C7\u00E7\u011F\u011E\u0131\u0130\u00D6\u00F6\u015E\u015F\u00DC\u00FC]/g, match => trMapHS[match] || match).normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase().trim().replace(/[()]/g, '-').replace(/(\d+)\s*(ml|gr|lt|kg|cc|mcg|mg|iu|doz|enj|wsp|oral|flakon|adet|ad|m|g|l|k|d)\b/gi, '$1-$2').replace(/\s+/g, '-').replace(/[^\w-]+/g, '').replace(/--+/g, '-').replace(/^-+|-+$/g, '') || 'isimsiz-urun';
                            }
                        }))
                    ];
                    applyLocalImages(allProductsForHeaderSearch);
                } catch (e) { 
                    console.error("Header arama için genel ürünler yüklenemedi:", e); 
                }
            }

            headerSearchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.trim().toLocaleLowerCase('tr-TR');
                clearTimeout(headerSearchDebounceTimer);
                if (searchTerm.length < 2) { 
                    headerResultsDropdown.style.display = 'none'; 
                    headerResultsList.innerHTML = ''; 
                    headerSearchWrapper.classList.remove('search-active');
                    return; 
                }
                headerSearchWrapper.classList.add('search-active');
                headerSearchDebounceTimer = setTimeout(() => {
                    const filtered = allProductsForHeaderSearch.filter(product => 
                        (product.ProductName || '').toLocaleLowerCase('tr-TR').includes(searchTerm) ||
                        (product.ProductCode || '').toLocaleLowerCase('tr-TR').includes(searchTerm)
                    ).slice(0, 7);
                    headerResultsList.innerHTML = ''; 
                    if (filtered.length > 0) {
                        filtered.forEach(product => { 
                            const listItem = document.createElement('li');
                            let rpImageUrl = localImageUrl(product);
                            const productSegForLink = product.segment; 
                            const productSlug = product.slugFn(product.ProductName); 

                            listItem.innerHTML = `
                                <a href="/urunler/${productSegForLink}/product-pages/${productSlug}/">
                                    <img src="${rpImageUrl}" alt="${product.ProductName}" class="suggestion-image" onerror="this.src='${FALLBACK_IMAGE_URL}'">
                                    <span class="suggestion-name">${product.ProductName}</span>
                                    <span class="suggestion-category">${product.cat || product.kategori || (productSegForLink === 'dermokozmetik' ? 'Dermo' : 'Hayvan S.')}</span>
                                </a>`;
                            headerResultsList.appendChild(listItem);
                        });
                    } else {
                        headerResultsList.innerHTML = '<li class="no-results">Sonuç bulunamadı.</li>';
                    }
                    headerResultsDropdown.style.display = 'block';
                }, 300); 
            });

            headerSearchInput.addEventListener('focus', function() {
                headerSearchWrapper.classList.add('search-active');
                if (headerSearchInput.value.length >= 2 && headerResultsList.children.length > 0 && headerResultsList.firstChild.className !== 'no-results') {
                    headerResultsDropdown.style.display = 'block';
                }
            });

            headerSearchInput.addEventListener('blur', function() {
                setTimeout(() => {
                    if (!G_isMouseOverHeaderDropdown) { 
                        headerResultsDropdown.style.display = 'none';
                        if (headerSearchInput.value.length < 2) { 
                             headerSearchWrapper.classList.remove('search-active');
                        }
                    }
                }, 150);
            });
            
            headerResultsDropdown.addEventListener('mouseenter', () => { G_isMouseOverHeaderDropdown = true; });
            headerResultsDropdown.addEventListener('mouseleave', () => { G_isMouseOverHeaderDropdown = false; });
        }

         document.addEventListener('click', function(event) {
            if (pageResultsDropdown && pageSearchInput && !pageSearchInput.contains(event.target) && !pageResultsDropdown.contains(event.target)) {
                pageResultsDropdown.style.display = 'none';
            }
            if (headerSearchWrapper && headerSearchInput && !headerSearchWrapper.contains(event.target) && headerResultsDropdown && !headerResultsDropdown.contains(event.target)) {
                headerResultsDropdown.style.display = 'none';
                 if (headerSearchInput.value.length < 2) { 
                     headerSearchWrapper.classList.remove('search-active');
                }
            }
        });
    }

    function setupMobileMenu() { 
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const nav = document.querySelector('.new-site-navigation');
        const siteHeader = document.getElementById('newSiteHeader');
        if (menuToggle && nav && siteHeader) {
            menuToggle.addEventListener('click', () => {
                const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                menuToggle.setAttribute('aria-expanded', String(!isExpanded));
                nav.classList.toggle('is-active');
                if (nav.classList.contains('is-active')) {
                  nav.style.top = `${siteHeader.offsetHeight}px`; 
                }
            });
             window.addEventListener('resize', () => { 
                if (nav.classList.contains('is-active')) {
                    nav.style.top = `${siteHeader.offsetHeight}px`;
                }
            });
        }
    }
    
    function setupIngredientsModal() { // Bu fonksiyonu DOMContentLoaded içine ekleyin
        const modal = document.getElementById('ingredientsModal');
        const closeBtn = document.getElementById('ingredientsModalCloseBtn');
        if(modal && closeBtn) {
            const closeAction = () => {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            };
            closeBtn.onclick = closeAction;
            modal.onclick = (event) => {
                if (event.target === modal) {
                    closeAction();
                }
            };
             document.addEventListener('keydown', (event) => { 
                if (event.key === "Escape" && modal.classList.contains('show')) {
                    closeAction();
                }
            });
        }
    }

    document.addEventListener('DOMContentLoaded', async function() {
        const currentYearEl = document.getElementById('currentYear');
        if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
        
        loadFavorites();

        setupMobileMenu(); 
        setupScrollToTopButton();
        setupLightbox();
        setupFavoritesModalInteractions();
        setupChatbotModal();
        await setupProductSearch();
        setupIngredientsModal();

        const slugStr = getSlugFromUrl(); 
        const canonicalLink = document.querySelector("link[rel='canonical']");
        const productDetailContainer = document.getElementById('productDetailContainer');

        if (slugStr) {
            if(canonicalLink) canonicalLink.href = window.location.href;
            if (window.STATIC_PRODUCT_DATA) {
                const d = window.STATIC_PRODUCT_DATA;
                currentProduct = d.product;
                currentEnhancedDetail = d.extra || d.detail;
                currentExtraData = d.extra;
                if(allProducts.length === 0) await loadAllProductsForSearch();
                displayProductDetail(currentProduct, d.detail || currentEnhancedDetail, d.extra);
                updateMetaTags(currentProduct, currentEnhancedDetail);
            } else if (productDetailContainer) {
                loadProductDetail(slugStr);
            }
        } else {
            if (productDetailContainer) { 
                const loadingContainer = productDetailContainer.querySelector('.loading-container');
                if(loadingContainer) loadingContainer.style.display = 'none';
            }
            if(canonicalLink) canonicalLink.href = window.location.origin + window.location.pathname;
        }
        window.addEventListener('languageChanged', async () => {
            biodermaDataCache = null;
            etatPurDataCache = null;
            esthedermDataCache = null;
            caudalieDataCache = null;
            if(currentProduct && currentProduct.brand){
                const brand = currentProduct.brand.toLowerCase();
                try{
                    if(brand === 'bioderma'){
                        const resp = await loadBiodermaData();
                        const data = findBiodermaExtra(resp, currentProduct);
                        if(data){ currentEnhancedDetail = data; currentExtraData = data; }
                    }else if(brand === 'caudalie'){
                        const resp = await loadCaudalieData();
                        const data = findBrandExtra(resp, currentProduct);
                        if(data){ currentEnhancedDetail = data; currentExtraData = data; }
                    }else if(brand === 'etat pur'){
                        const resp = await loadEtatPurData();
                        const data = findBrandExtra(resp, currentProduct);
                        if(data){ currentEnhancedDetail = data; currentExtraData = data; }
                    }else if(brand === 'esthederm' || brand === 'institut esthederm'){
                        const resp = await loadEsthedermData();
                        const data = findBrandExtra(resp, currentProduct);
                        if(data){ currentEnhancedDetail = data; currentExtraData = data; }
                    }
                }catch(e){
                    console.warn('Ek veriler yeniden yüklenemedi:', e);
                }
            }
            if(currentProduct) displayProductDetail(currentProduct, currentEnhancedDetail, currentExtraData);
        });
    });

  </script>
  <!--STATIC_PRODUCT_DATA-->
</body>
</html>
